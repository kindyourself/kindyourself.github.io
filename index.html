<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <!-- æ·»åŠ å…¨å±€ç¦ç”¨ Referer -->
      <meta name="referrer" content="no-referrer" />
      <meta charset="utf-8" />
       
      <meta name="keywords" content="æŠ€æœ¯,ç¼–ç¨‹,å¼€å‘,Hexo" />
       
      <meta name="description" content="ä¸ªäººæŠ€æœ¯åšå®¢ï¼Œåˆ†äº«ç¼–ç¨‹ã€å¼€å‘ç»éªŒå’Œç”Ÿæ´»æ„Ÿæ‚Ÿ" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> Gavin&#39;s Blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
      <!-- Font Awesome 6 -->
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />
    <link rel="alternate" href="/atom.xml" title="Gavin's Blog" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Gavin&#39;s Blog</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['é¢æœå¤§æµ·ï¼Œæ˜¥æš–èŠ±å¼€', 'æ„¿ä½ ä¸€ç”ŸåŠªåŠ›ï¼Œä¸€ç”Ÿè¢«çˆ±', 'æƒ³è¦çš„éƒ½æ‹¥æœ‰ï¼Œå¾—ä¸åˆ°çš„éƒ½é‡Šæ€€'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="[layout]-gitHub-hexo-ä¸ªäººåšå®¢å‡çº§ç‰ˆ"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2025/06/11/gitHub-hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%8D%87%E7%BA%A7%E7%89%88/"
    >gitHub hexo ä¸ªäººåšå®¢å‡çº§ç‰ˆ</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2025/06/11/gitHub-hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%8D%87%E7%BA%A7%E7%89%88/" class="article-date">
  <time datetime="2025-06-11T01:52:44.000Z" itemprop="datePublished">2025-06-11</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%85%B6%E4%BB%96/">å…¶ä»–</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>9å¹´å‰è‡ªå·±å¼€å§‹å­¦ä¹ gitHub hexoæ­å»ºä¸ªäººåšå®¢ï¼ŒæŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œæœ€åç”¨hexo æ­å»ºä¸€ä¸ªä¸ªäººåšå®¢ï¼Œæ‰˜ç®¡åœ¨gitHubä¸Šï¼Œå‰æ®µæ—¶é—´æ¢äº†ä¸€ä¸ªç”µè„‘ï¼Œæˆ‘åœ¨æ–°çš„ç”µè„‘ä¸Šæƒ³å†å‘å¸ƒä¸€ç¯‡æ–‡ç« ï¼Œæ‰å‘ç°ä¸è¡Œäº†ã€‚å› ä¸ºä¹‹å‰åªåœ¨GitHubæ‰˜ç®¡äº†hexoç”Ÿæˆçš„é™æ€æ–‡ä»¶(public)ï¼Œå¿˜è®°å¤‡ä»½Hexoçš„æºæ–‡ä»¶ã€‚<br>source&#x2F;_posts&#x2F;ï¼ˆæ‰€æœ‰æ–‡ç« ï¼‰<br>_config.ymlï¼ˆHexo ä¸»é…ç½®ï¼‰<br>themes&#x2F;ï¼ˆä¸»é¢˜æ–‡ä»¶ï¼‰<br>package.jsonï¼ˆä¾èµ–åˆ—è¡¨ï¼‰<br>å¦‚æœä½ é‡åˆ°è¿™ç§æƒ…å†µï¼Œè·Ÿç€æˆ‘è¿›å…¥æ¥ä¸‹æ¥çš„é‡æ–°éƒ¨ç½²è¿‡ç¨‹ã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e0619df8f245">gitHub hexo ä¸ªäººåšå®¢åŸºç¡€ç‰ˆ</a>ã€‚</p>
<h3 id="é¦–å…ˆç¡®è®¤ä½ æœ¬åœ°å·²ç»ä¸å­˜åœ¨source-x2F-postsæ–‡ä»¶å¤¹ï¼Œå†æŸ¥ä¸€æŸ¥githubæ˜¯å¦æœ‰å¤‡ä»½ï¼Œå¦‚ä½•è¿œç¨‹å’Œæœ¬åœ°éƒ½æ²¡æœ‰ï¼Œé‚£å°±åªèƒ½é‡æ–°éƒ¨ç½²äº†ã€‚"><a href="#é¦–å…ˆç¡®è®¤ä½ æœ¬åœ°å·²ç»ä¸å­˜åœ¨source-x2F-postsæ–‡ä»¶å¤¹ï¼Œå†æŸ¥ä¸€æŸ¥githubæ˜¯å¦æœ‰å¤‡ä»½ï¼Œå¦‚ä½•è¿œç¨‹å’Œæœ¬åœ°éƒ½æ²¡æœ‰ï¼Œé‚£å°±åªèƒ½é‡æ–°éƒ¨ç½²äº†ã€‚" class="headerlink" title="é¦–å…ˆç¡®è®¤ä½ æœ¬åœ°å·²ç»ä¸å­˜åœ¨source&#x2F;_postsæ–‡ä»¶å¤¹ï¼Œå†æŸ¥ä¸€æŸ¥githubæ˜¯å¦æœ‰å¤‡ä»½ï¼Œå¦‚ä½•è¿œç¨‹å’Œæœ¬åœ°éƒ½æ²¡æœ‰ï¼Œé‚£å°±åªèƒ½é‡æ–°éƒ¨ç½²äº†ã€‚"></a>é¦–å…ˆç¡®è®¤ä½ æœ¬åœ°å·²ç»ä¸å­˜åœ¨source&#x2F;_postsæ–‡ä»¶å¤¹ï¼Œå†æŸ¥ä¸€æŸ¥githubæ˜¯å¦æœ‰å¤‡ä»½ï¼Œå¦‚ä½•è¿œç¨‹å’Œæœ¬åœ°éƒ½æ²¡æœ‰ï¼Œé‚£å°±åªèƒ½é‡æ–°éƒ¨ç½²äº†ã€‚</h3><blockquote>
<p>1.é™æ€æ–‡ä»¶ï¼ˆå¦‚ public&#x2F; ä¸‹çš„ HTMLï¼‰å¯é€šè¿‡æµè§ˆå™¨å³é”®ã€ŒæŸ¥çœ‹é¡µé¢æºä»£ç ã€å¤åˆ¶æ­£æ–‡ï¼Œæˆ–ä½¿ç”¨å·¥å…·è§£æ HTML ç»“æ„ã€‚</p>
</blockquote>
<blockquote>
<p>2.ä½¿ç”¨ Markdown æ¸²æŸ“ï¼ŒHTML ä¸­çš„ â€œarticle â€æ ‡ç­¾å†…é€šå¸¸åŒ…å«åŸå§‹æ–‡æœ¬çš„è½¬æ¢ç»“æœã€‚</p>
</blockquote>
<blockquote>
<p>3.ç”Ÿæˆ.mdæ–‡ä»¶æ”¾åœ¨_postsæ–‡ä»¶å¤¹é‡Œé¢ã€‚</p>
</blockquote>
<h1 id="1-å¤‡ä»½Hexoçš„æºæ–‡ä»¶"><a href="#1-å¤‡ä»½Hexoçš„æºæ–‡ä»¶" class="headerlink" title="1.å¤‡ä»½Hexoçš„æºæ–‡ä»¶"></a>1.å¤‡ä»½Hexoçš„æºæ–‡ä»¶</h1><p><strong>åˆ°è¿™é‡Œå°±å¯ä»¥é‡æ–°å‘å¸ƒæ–‡ç« äº†ï¼Œä½†æ˜¯ä¸ºäº†ä¸‹ä¸€æ¬¡ä¸è¦å†å‡ºç°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦å¯¹Hexoçš„æºæ–‡ä»¶è¿›è¡Œå¤‡ä»½ã€‚</strong></p>
<p><strong>å¤‡ä»½æ–¹å¼å…±æœ‰ä¸¤ç§ï¼š</strong></p>
<blockquote>
<p>1.åœ¨å½“å‰gitHubç®¡ç†çš„hexoç”Ÿæˆçš„é™æ€æ–‡ä»¶ä»“åº“ä¸­å†å¼€ä¸€ä¸ªåˆ†æ”¯ï¼Œç”¨äºå¤‡ä»½Hexoçš„æºæ–‡ä»¶ã€‚</p>
</blockquote>
<blockquote>
<p>2.å•ç‹¬åˆ›å»ºä¸€ä¸ªç§æœ‰ä»“åº“ç”¨äºå¤‡ä»½Hexoçš„æºæ–‡ä»¶ã€‚</p>
</blockquote>
<p><em>å› ä¸ºåšå®¢éœ€è¦å¯¹å¤–å±•ç¤ºï¼Œæ‰€ä»¥å½“å‰gitHubç®¡ç†çš„hexoç”Ÿæˆçš„é™æ€æ–‡ä»¶ä»“åº“å¿…é¡»æ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥å¦‚æœä½ é€‰æ‹©ç¬¬ä¸€ç§æ–¹å¼ä½ çš„åŸæ–‡ä»¶ä¹Ÿåªèƒ½æ”¾åœ¨å…¬å¼€çš„ä»“åº“åˆ†æ”¯ã€‚å¦‚æœä¸æƒ³å°†è‡ªå·±çš„Hexoçš„æºæ–‡ä»¶å…¬å¼€å°±å¯ä»¥é€‰æ‹©ç¬¬äºŒç§æ–¹å¼ï¼šå•ç‹¬åˆ›å»ºä¸€ä¸ªç§æœ‰çš„ä»“åº“ç”¨æ¥å¤‡ä»½Hexoçš„æºæ–‡ä»¶ã€‚</em></p>
<h1 id="2-è‡ªåŠ¨åŒ–"><a href="#2-è‡ªåŠ¨åŒ–" class="headerlink" title="2.è‡ªåŠ¨åŒ–"></a>2.è‡ªåŠ¨åŒ–</h1><blockquote>
<p>ä¸Šæ–‡åˆ›å»ºå®Œæˆåæ¯æ¬¡å‘å¸ƒåšå®¢ï¼Œéƒ½éœ€è¦å»gitæäº¤å¤‡ä»½æ–‡ä»¶ï¼Œè¿™æ ·å¤ªéº»çƒ¦äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå°†è¿™äº›é‡å¤æ­¥éª¤è‡ªåŠ¨åŒ–ã€‚</p>
</blockquote>
<p><strong>åˆ›å»ºä¸€ä¸ªdeploy.shæ”¾åœ¨åšå®¢æ ¹ç›®å½•ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®ç»å¯¹è·¯å¾„</span><br><span class="line">BLOG_DIR=&quot;å®é™…è·¯å¾„/blog&quot;</span><br><span class="line"></span><br><span class="line"># è¿›å…¥åšå®¢ç›®å½•</span><br><span class="line">cd &quot;$BLOG_DIR&quot; || exit 1</span><br><span class="line"></span><br><span class="line"># Hexoæ“ä½œ</span><br><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br><span class="line"></span><br><span class="line"># æºæ–‡ä»¶å¤‡ä»½</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;è‡ªåŠ¨å¤‡ä»½: $(date +&quot;%Y-%m-%d %H:%M&quot;)&quot;</span><br><span class="line">git push origin main</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ ·ä¸€ä¸ªç®€å•çš„å‘å¸ƒåšå®¢å¹¶ä¸”æºæ–‡ä»¶å¤‡ä»½çš„è‡ªåŠ¨åŒ–è„šæœ¬å°±å¥½äº†ã€‚<br>ä»¥åæ¯ä¸€æ¬¡å†™å®Œæ–‡ç« åå†åœ¨ç»ˆç«¯è¿›å…¥â€å®é™…è·¯å¾„&#x2F;blogâ€ æ‰§è¡Œ.&#x2F;deploy.sh å°±è¡Œäº†</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/1976231-be565414c227becd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰§è¡Œ./deploy.sh"></p>
<p><strong>é¦–æ¬¡æ‰§è¡Œéœ€è¦å…ˆè®¾ç½®æ‰§è¡Œæƒé™ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x deploy.sh</span><br></pre></td></tr></table></figure>

<h1 id="3-å¤šåšå®¢è‡ªåŠ¨åŒ–"><a href="#3-å¤šåšå®¢è‡ªåŠ¨åŒ–" class="headerlink" title="3.å¤šåšå®¢è‡ªåŠ¨åŒ–"></a>3.å¤šåšå®¢è‡ªåŠ¨åŒ–</h1><blockquote>
<p>å½“æˆ‘ä»¬æœ‰å¤šä¸ªåšå®¢éœ€è¦åŒæ­¥æ˜¯å°±éœ€è¦å¯¹Hexoçš„æºæ–‡ä»¶è¿›è¡Œå†æ¬¡ä¿®æ”¹ã€‚</p>
</blockquote>
<p>æˆ‘ä»¥githubä¸ºä¾‹ï¼š</p>
<p><strong>1.é¦–å…ˆæˆ‘ä»¬çš„æœ‰ä¸¤ä¸ªGitHubè´¦å·å¹¶ä¸”æœ¬åœ°é…ç½®å¥½SSH</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/1976231-4b672d531de2e4be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ¬åœ°SSHé…ç½®"></p>
<p><strong>2.æ·»åŠ é…ç½®æ–‡ä»¶</strong></p>
<h3 id="config-ymlï¼šä¸ºå…¶ä¸­ä¸€ä¸ªGitHubè´¦å·çš„é…ç½®"><a href="#config-ymlï¼šä¸ºå…¶ä¸­ä¸€ä¸ªGitHubè´¦å·çš„é…ç½®" class="headerlink" title="_config.ymlï¼šä¸ºå…¶ä¸­ä¸€ä¸ªGitHubè´¦å·çš„é…ç½®"></a>_config.ymlï¼šä¸ºå…¶ä¸­ä¸€ä¸ªGitHubè´¦å·çš„é…ç½®</h3><blockquote>
<p>url: <a href="https://gavincarter1991.github.io/#">https://gavincarter1991.github.io#</a> åšå®¢å®Œæ•´URL</p>
<p>source_dir: source  # è¿™ä¸ªå€¼ä¼šè¢«è„šæœ¬è¦†ç›–ï¼Œä½†éœ€è¦å­˜åœ¨</p>
<p>public_dir: public_kind</p>
<p> <img src="https://upload-images.jianshu.io/upload_images/1976231-d4cc0887e0a1f1c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="deploy"></p>
</blockquote>
<h3 id="config-other-ymlï¼šä¸ºå¦å¤–ä¸€ä¸ªGitHubè´¦å·çš„é…ç½®"><a href="#config-other-ymlï¼šä¸ºå¦å¤–ä¸€ä¸ªGitHubè´¦å·çš„é…ç½®" class="headerlink" title="_config_other.ymlï¼šä¸ºå¦å¤–ä¸€ä¸ªGitHubè´¦å·çš„é…ç½®"></a>_config_other.ymlï¼šä¸ºå¦å¤–ä¸€ä¸ªGitHubè´¦å·çš„é…ç½®</h3><blockquote>
<p>url: <a target="_blank" rel="noopener" href="https://kindyourself.github.io/">https://kindyourself.github.io</a> # åšå®¢å®Œæ•´URL</p>
<p>source_dir:  &#x2F;Users&#x2F;dianyin&#x2F;Desktop&#x2F;blog&#x2F;temp_source_gavin</p>
<p>public_dir: public_gavin</p>
<p> <img src="https://upload-images.jianshu.io/upload_images/1976231-e88ac014d9ccf8ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="deploy"></p>
</blockquote>
<p>è€ƒè™‘åˆ°å¤šä¸ªåšå®¢å†…å®¹å¯èƒ½ä¸ä¸€æ ·ï¼šåœ¨æ ¹ç›®å½•æ–°å»ºä¸€ä¸ªscriptsæ–‡ä»¶å¤¹åˆ›å»ºä¸€ä¸ªJSè„šæœ¬multi-site.jsè¿›è¡Œå†…å®¹é…ç½®ï¼Œå…¬å…±æ–‡ç« æ”¾åœ¨source&#x2F;_postsï¼Œä¸åŒçš„æ–‡ç« å„è‡ªæ”¾åœ¨è‡ªå·±çš„ç›®å½•é‡Œé¢ï¼ˆsource&#x2F;_posts_gavin  source&#x2F;_posts_gavin _posts_kindï¼‰è„šæœ¬ä¼šåˆ†å¼€å‘å¸ƒã€‚</p>
<p><strong>multi-site.js å†…å®¹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs-extra&#x27;);</span><br><span class="line">const path = require(&#x27;path&#x27;);</span><br><span class="line">const &#123; promisify &#125; = require(&#x27;util&#x27;);</span><br><span class="line">const exec = promisify(require(&#x27;child_process&#x27;).exec);</span><br><span class="line"></span><br><span class="line">hexo.extend.filter.register(&#x27;before_generate&#x27;, async function() &#123;</span><br><span class="line">  const baseDir = hexo.base_dir;</span><br><span class="line">  const currentSite = process.env.HEXO_SITE || &#x27;kind&#x27;;</span><br><span class="line">  </span><br><span class="line">  const sites = &#123;</span><br><span class="line">    kind: &#123;</span><br><span class="line">      exclusiveDir: &#x27;source/_posts_kind&#x27;,</span><br><span class="line">      commonDir: &#x27;source/_posts&#x27;,</span><br><span class="line">      output: &#x27;public_kind&#x27;,</span><br><span class="line">      config: &#x27;_config.yml&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    gavin: &#123;</span><br><span class="line">      exclusiveDir: &#x27;source/_posts_gavin&#x27;,</span><br><span class="line">      commonDir: &#x27;source/_posts&#x27;,</span><br><span class="line">      output: &#x27;public_gavin&#x27;,</span><br><span class="line">      config: &#x27;_config_gavin.yml&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  const site = sites[currentSite];</span><br><span class="line">  if (!site) return;</span><br><span class="line">  </span><br><span class="line">  // åˆ›å»ºä¸´æ—¶æºç›®å½•</span><br><span class="line">  const tempSourceDir = path.join(baseDir, `temp_source_$&#123;currentSite&#125;`);</span><br><span class="line">  fs.ensureDirSync(tempSourceDir);</span><br><span class="line">  fs.emptyDirSync(tempSourceDir);</span><br><span class="line">  </span><br><span class="line">  // 1. å¤åˆ¶æ•´ä¸ªsourceç›®å½•ï¼ˆåŒ…æ‹¬æ‰€æœ‰å…±äº«æ–‡ä»¶ï¼‰</span><br><span class="line">  fs.copySync(path.join(baseDir, &#x27;source&#x27;), tempSourceDir);</span><br><span class="line">  </span><br><span class="line">  // 2. æ¸…ç©ºä¸´æ—¶æºç›®å½•çš„_postsæ–‡ä»¶å¤¹</span><br><span class="line">  const tempPostsDir = path.join(tempSourceDir, &#x27;_posts&#x27;);</span><br><span class="line">  fs.ensureDirSync(tempPostsDir);</span><br><span class="line">  fs.emptyDirSync(tempPostsDir);</span><br><span class="line">  </span><br><span class="line">  // 3. å¤åˆ¶å…±åŒæ–‡ç« </span><br><span class="line">  const commonPosts = path.join(baseDir, site.commonDir);</span><br><span class="line">  if (fs.existsSync(commonPosts)) &#123;</span><br><span class="line">    fs.readdirSync(commonPosts).forEach(file =&gt; &#123;</span><br><span class="line">      if (file.endsWith(&#x27;.md&#x27;)) &#123;</span><br><span class="line">        fs.copySync(</span><br><span class="line">          path.join(commonPosts, file),</span><br><span class="line">          path.join(tempPostsDir, file)</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // 4. å¤åˆ¶ä¸“å±æ–‡ç« </span><br><span class="line">  const exclusivePosts = path.join(baseDir, site.exclusiveDir);</span><br><span class="line">  if (fs.existsSync(exclusivePosts)) &#123;</span><br><span class="line">    fs.readdirSync(exclusivePosts).forEach(file =&gt; &#123;</span><br><span class="line">      if (file.endsWith(&#x27;.md&#x27;)) &#123;</span><br><span class="line">        fs.copySync(</span><br><span class="line">          path.join(exclusivePosts, file),</span><br><span class="line">          path.join(tempPostsDir, file)</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // 5. åŠ¨æ€åº”ç”¨é…ç½®</span><br><span class="line">  hexo.config.source_dir = tempSourceDir;</span><br><span class="line">  hexo.config.public_dir = site.output;</span><br><span class="line">  </span><br><span class="line">  // 6. éªŒè¯å¤åˆ¶ç»“æœ</span><br><span class="line">  const postCount = fs.readdirSync(tempPostsDir).length;</span><br><span class="line">  hexo.log.info(`âœ… $&#123;currentSite&#125; ç«™ç‚¹å‡†å¤‡å®Œæˆ: $&#123;postCount&#125; ç¯‡æ–‡ç« `);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// æ·»åŠ éƒ¨ç½²åæ¸…ç†é’©å­</span><br><span class="line">hexo.extend.filter.register(&#x27;after_deploy&#x27;, function() &#123;</span><br><span class="line">  const baseDir = hexo.base_dir;</span><br><span class="line">  const currentSite = process.env.HEXO_SITE;</span><br><span class="line">  </span><br><span class="line">  if (currentSite) &#123;</span><br><span class="line">    const tempSourceDir = path.join(baseDir, `temp_source_$&#123;currentSite&#125;`);</span><br><span class="line">    if (fs.existsSync(tempSourceDir)) &#123;</span><br><span class="line">      fs.removeSync(tempSourceDir);</span><br><span class="line">      hexo.log.info(`ğŸ§¹ æ¸…ç†ä¸´æ—¶ç›®å½•: $&#123;tempSourceDir&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å½“ç„¶deploy.shä¹Ÿéœ€è¦æ›´æ”¹ä¸ºï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line"></span><br><span class="line"># é…ç½®åŒº</span><br><span class="line">BLOG_DIR=&quot;/Users/dianyin/Desktop/blog&quot;</span><br><span class="line">SOURCE_BRANCH=&quot;master&quot;</span><br><span class="line">PRIVATE_REPO_KIND=&quot;git@github.com-kind:kindyourself/blog-source.git&quot;</span><br><span class="line">PRIVATE_REPO_GAVIN=&quot;git@github.com-gavin:gavincarter1991/blog-source.git&quot;</span><br><span class="line"></span><br><span class="line">cd &quot;$BLOG_DIR&quot; || &#123; echo &quot;âŒ æ— æ³•è¿›å…¥åšå®¢ç›®å½•&quot;; exit 1; &#125;</span><br><span class="line"></span><br><span class="line"># æ¸…ç†ä¸Šæ¬¡ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶</span><br><span class="line">rm -rf temp_source_* public*</span><br><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆ Kind ç«™ç‚¹</span><br><span class="line">echo &quot;===== ğŸš€ ç”Ÿæˆ Kind ç«™ç‚¹ =====&quot;</span><br><span class="line">export HEXO_SITE=&quot;kind&quot;</span><br><span class="line">hexo generate --config _config.yml</span><br><span class="line"></span><br><span class="line"># éªŒè¯ç”Ÿæˆç»“æœ</span><br><span class="line">echo &quot;Kind ç«™ç‚¹å†…å®¹:&quot;</span><br><span class="line">ls -lh public_kind</span><br><span class="line">tree -L 2 public_kind | head -20</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆ Gavin ç«™ç‚¹</span><br><span class="line">echo &quot;===== ğŸš€ ç”Ÿæˆ Gavin ç«™ç‚¹ =====&quot;</span><br><span class="line">export HEXO_SITE=&quot;gavin&quot;</span><br><span class="line">hexo generate --config _config_gavin.yml</span><br><span class="line"></span><br><span class="line"># éªŒè¯ç”Ÿæˆç»“æœ</span><br><span class="line">echo &quot;Gavin ç«™ç‚¹å†…å®¹:&quot;</span><br><span class="line">ls -lh public_gavin</span><br><span class="line">tree -L 2 public_gavin | head -20</span><br><span class="line"></span><br><span class="line"># éƒ¨ç½²åˆ°GitHub Pages</span><br><span class="line">echo &quot;===== ğŸš€ éƒ¨ç½²åˆ° GitHub Pages =====&quot;</span><br><span class="line">echo &quot;éƒ¨ç½² Kind ç«™ç‚¹...&quot;</span><br><span class="line">export HEXO_SITE=&quot;kind&quot;</span><br><span class="line">hexo deploy --config _config.yml</span><br><span class="line"></span><br><span class="line">echo &quot;éƒ¨ç½² Gavin ç«™ç‚¹...&quot;</span><br><span class="line">export HEXO_SITE=&quot;gavin&quot;</span><br><span class="line">hexo deploy --config _config_gavin.yml</span><br><span class="line"></span><br><span class="line"># å¤‡ä»½åˆ°ç§æœ‰ä»“åº“</span><br><span class="line">echo &quot;===== ğŸ“¦ å¤‡ä»½æºæ–‡ä»¶åˆ°ç§æœ‰ä»“åº“ =====&quot;</span><br><span class="line">git add .</span><br><span class="line">if git diff-index --quiet HEAD --; then</span><br><span class="line">    echo &quot;ğŸ”„ æ— æ–‡ä»¶å˜æ›´&quot;</span><br><span class="line">else</span><br><span class="line">    git commit -m &quot;è‡ªåŠ¨å¤‡ä»½: $(date +&quot;%Y-%m-%d %H:%M:%S&quot;)&quot;</span><br><span class="line">    </span><br><span class="line">    # æ¨é€åˆ°ä¸¤ä¸ªç§æœ‰ä»“åº“</span><br><span class="line">    git push &quot;$PRIVATE_REPO_KIND&quot; &quot;$SOURCE_BRANCH&quot; &amp;&amp; \</span><br><span class="line">        echo &quot;âœ… kindyourself/blog-source å¤‡ä»½æˆåŠŸ&quot; || \</span><br><span class="line">        echo &quot;âŒ kindyourself/blog-source å¤‡ä»½å¤±è´¥&quot;</span><br><span class="line">    </span><br><span class="line">    git push &quot;$PRIVATE_REPO_GAVIN&quot; &quot;$SOURCE_BRANCH&quot; &amp;&amp; \</span><br><span class="line">        echo &quot;âœ… gavincarter1991/blog-source å¤‡ä»½æˆåŠŸ&quot; || \</span><br><span class="line">        echo &quot;âŒ gavincarter1991/blog-source å¤‡ä»½å¤±è´¥&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;===== âœ… éƒ¨ç½²å®Œæˆ =====&quot;</span><br><span class="line">echo &quot;åšå®¢åœ°å€1: https://kindyourself.github.io&quot;</span><br><span class="line">echo &quot;åšå®¢åœ°å€2: https://gavincarter1991.github.io&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä»¥ä¸Šå°±æ˜¯gitHub hexo ä¸ªäººåšå®¢å‡çº§ç‰ˆ</strong></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CHexo%E2%80%9D/" rel="tag">â€œHexoâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9Cgithub/" rel="tag">â€œgithub&quot;</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9C%E5%8D%9A%E5%AE%A2/" rel="tag">â€œåšå®¢&quot;</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="[layout]-widget-advanced"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2025/06/07/widget-advanced/"
    >Widgetè¿›é˜¶</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2025/06/07/widget-advanced/" class="article-date">
  <time datetime="2025-06-07T12:17:56.000Z" itemprop="datePublished">2025-06-07</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Flutter/">Flutter</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-Widget-ä»‹ç»"><a href="#1-Widget-ä»‹ç»" class="headerlink" title="1.Widget ä»‹ç»"></a>1.Widget ä»‹ç»</h2><blockquote>
<p>Everything is a widget è¿™æ˜¯ä½ å­¦ä¹  flutter ä¼šå¬åˆ°çš„æœ€å¤šçš„ä¸€å¥è¯ã€‚å› ä¸ºåœ¨ Flutter ä¸­å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ª widgetï¼Œåœ¨ flutter ä¸­ UI çš„æ„å»ºå’Œäº‹ä»¶çš„å¤„ç†åŸºæœ¬éƒ½æ˜¯é€šè¿‡ widget çš„ç»„åˆåŠåµŒå¥—æ¥å®Œæˆçš„ã€‚åœ¨ iOS ä¸­æˆ‘ä»¬ç»å¸¸æåŠçš„â€œç»„ä»¶â€ã€â€œæ§ä»¶â€åœ¨ flutter ä¸­å°±æ˜¯ widgetï¼Œå½“ç„¶ widget çš„èŒƒå›´æ¯”ä¹‹æ›´åŠ å¹¿æ³›ã€‚å¦‚ï¼šæ‰‹åŠ¿æ£€æµ‹ GestureDetectorã€ä¸»é¢˜ Theme å’ŒåŠ¨ç”»å®¹å™¨ AnimatedContainer ç­‰ä¹Ÿæ˜¯ widgetã€‚</p>
</blockquote>
<p><strong>Flutter é»˜è®¤æ”¯æŒçš„ä¸¤ç§è®¾è®¡é£æ ¼ï¼š</strong></p>
<blockquote>
<p><strong>1.Material components Designï¼š</strong> è°·æ­Œï¼ˆandroidï¼‰çš„ UI é£æ ¼ï¼Œä¸»è¦ä¸º Android è®¾è®¡ï¼Œä½†ä¹Ÿæ”¯æŒè·¨å¹³å°ä½¿ç”¨ã€‚</p>
</blockquote>
<blockquote>
<p><strong>2.Cupertino Designï¼š</strong> è‹¹æœï¼ˆiOSï¼‰çš„ UI é£æ ¼ï¼Œæ¨¡ä»¿è‹¹æœåŸç”Ÿ UIKit é£æ ¼ã€‚é«˜åº¦è¿˜åŸ iOS åŸç”Ÿä½“éªŒï¼Œé€‚åˆéœ€è¦ä¸è‹¹æœç”Ÿæ€ä¸€è‡´çš„åº”ç”¨ã€‚</p>
</blockquote>
<h2 id="2-Widget-åˆ†ç±»"><a href="#2-Widget-åˆ†ç±»" class="headerlink" title="2.Widget åˆ†ç±»"></a>2.Widget åˆ†ç±»</h2><p><strong><em>1.æŒ‰çŠ¶æ€ç®¡ç†</em></strong></p>
<h6 id="ä¸€ã€StatelessWidgetï¼š"><a href="#ä¸€ã€StatelessWidgetï¼š" class="headerlink" title="ä¸€ã€StatelessWidgetï¼š"></a>ä¸€ã€StatelessWidgetï¼š</h6><p>æ— çŠ¶æ€ç»„ä»¶ï¼Œé€šè¿‡ build æ–¹æ³•è¿”å›é™æ€ UIã€‚ä¸å¯å˜ï¼Œå±æ€§ï¼ˆfinalï¼‰åœ¨åˆ›å»ºåæ— æ³•ä¿®æ”¹ï¼Œé€‚ç”¨äºä¸éœ€è¦å†…éƒ¨çŠ¶æ€å˜åŒ–çš„åœºæ™¯ï¼ˆå¦‚æ–‡æœ¬æ˜¾ç¤ºã€å›¾æ ‡ï¼‰ï¼Œä¸ä¾èµ–ç”¨æˆ·äº¤äº’æˆ–æ•°æ®å˜åŒ–çš„ UI éƒ¨åˆ†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">class IconTextButton extends StatelessWidget &#123;</span><br><span class="line">  final String iconName;</span><br><span class="line">  final String label;</span><br><span class="line">  final VoidCallback onPressed;</span><br><span class="line"></span><br><span class="line">  const IconTextButton(&#123;</span><br><span class="line">    super.key,</span><br><span class="line">    required this.iconName,</span><br><span class="line">    required this.label,</span><br><span class="line">    required this.onPressed,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return GestureDetector(</span><br><span class="line">      onTap: onPressed,</span><br><span class="line">      child: Column(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Image.asset(</span><br><span class="line">            &quot;assets/images/$iconName.png&quot;,</span><br><span class="line">            width: 40,</span><br><span class="line">            height: 40,</span><br><span class="line">          ),</span><br><span class="line">          const SizedBox(</span><br><span class="line">            height: 10,</span><br><span class="line">          ), // å›¾æ ‡</span><br><span class="line">          Text(</span><br><span class="line">            label,</span><br><span class="line">            style: const TextStyle(color: ColorConstant.color33, fontSize: 10),</span><br><span class="line">          ), // æ–‡å­—</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="äºŒã€StatefulWidgetï¼š"><a href="#äºŒã€StatefulWidgetï¼š" class="headerlink" title="äºŒã€StatefulWidgetï¼š"></a>äºŒã€StatefulWidgetï¼š</h6><p>æœ‰çŠ¶æ€ç»„ä»¶ï¼Œé€šè¿‡ State å¯¹è±¡ç®¡ç†åŠ¨æ€æ•°æ®ã€‚å½“çŠ¶æ€å˜åŒ–æ—¶è°ƒç”¨ setState è§¦å‘ UI æ›´æ–°ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’ï¼ˆå¦‚æŒ‰é’®ç‚¹å‡»ã€è¡¨å•è¾“å…¥ï¼‰å’Œä¾èµ–å®æ—¶æ•°æ®å˜åŒ–ï¼ˆå¦‚è®¡æ•°å™¨ã€åŠ¨æ€åˆ—è¡¨ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">// ä¸Šä¸‹æ»šåŠ¨çš„æ¶ˆæ¯è½®æ’­</span><br><span class="line">class MarqueeWidget extends StatefulWidget &#123;</span><br><span class="line">  /// å­è§†å›¾æ•°é‡</span><br><span class="line">  final int count;</span><br><span class="line"></span><br><span class="line">  ///å­è§†å›¾æ„å»ºå™¨</span><br><span class="line">  final IndexedWidgetBuilder itemBuilder;</span><br><span class="line"></span><br><span class="line">  ///è½®æ’­çš„æ—¶é—´é—´éš”</span><br><span class="line">  final int loopSeconds;</span><br><span class="line"></span><br><span class="line">  const MarqueeWidget(&#123;</span><br><span class="line">    super.key,</span><br><span class="line">    required this.count,</span><br><span class="line">    required this.itemBuilder,</span><br><span class="line">    this.loopSeconds = 5,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  _MarqueeWidgetState createState() =&gt; _MarqueeWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class _MarqueeWidgetState extends State&lt;MarqueeWidget&gt; &#123;</span><br><span class="line">  late PageController _controller;</span><br><span class="line">  late Timer _timer;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void initState() &#123;</span><br><span class="line">    super.initState();</span><br><span class="line">    _controller = PageController();</span><br><span class="line">    _timer = Timer.periodic(Duration(seconds: widget.loopSeconds), (timer) &#123;</span><br><span class="line">      if (_controller.page != null) &#123;</span><br><span class="line">        // å¦‚æœå½“å‰ä½äºæœ€åä¸€é¡µï¼Œåˆ™ç›´æ¥è·³è½¬åˆ°ç¬¬ä¸€é¡µï¼Œä¸¤è€…å†…å®¹ç›¸åŒï¼Œè·³è½¬æ—¶è§†è§‰ä¸Šæ— æ„ŸçŸ¥</span><br><span class="line">        if (_controller.page!.round() &gt;= widget.count) &#123;</span><br><span class="line">          _controller.jumpToPage(0);</span><br><span class="line">        &#125;</span><br><span class="line">        _controller.nextPage(</span><br><span class="line">            duration: const Duration(seconds: 1), curve: Curves.linear);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return PageView.builder(</span><br><span class="line">      scrollDirection: Axis.vertical,</span><br><span class="line">      controller: _controller,</span><br><span class="line">      itemBuilder: (buildContext, index) &#123;</span><br><span class="line">        if (index &lt; widget.count) &#123;</span><br><span class="line">          return widget.itemBuilder(buildContext, index);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          return widget.itemBuilder(buildContext, 0);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      itemCount: widget.count + 1,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void dispose() &#123;</span><br><span class="line">    super.dispose();</span><br><span class="line">    _controller.dispose();</span><br><span class="line">    _timer.cancel();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><em>2.æŒ‰åŠŸèƒ½åˆ†ç±»</em></strong></p>
<blockquote>
<p><strong>1.å¸ƒå±€ç±» Widgetï¼š</strong> æ§åˆ¶å­ Widget çš„æ’åˆ—æ–¹å¼ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å¸¸è§æœ‰ï¼š</span><br><span class="line">Row/Columnï¼šæ°´å¹³/å‚ç›´æ’åˆ—å­é¡¹ï¼ˆåŸºäº Flexboxï¼‰ã€‚</span><br><span class="line">Stackï¼šå­ Widget å †å ï¼ˆç±»ä¼¼ CSS çš„ç»å¯¹å®šä½ï¼‰ã€‚</span><br><span class="line">Expanded/Flexibleï¼šåœ¨ Row æˆ– Column ä¸­åˆ†é…å‰©ä½™ç©ºé—´ã€‚</span><br><span class="line">Containerï¼šç»“åˆå¸ƒå±€ã€è£…é¥°ã€è¾¹è·ç­‰åŠŸèƒ½</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>2.åŸºç¡€ç»„ä»¶ Widgetï¼š</strong> æ„æˆ UI çš„åŸºæœ¬å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¸¸è§æœ‰ï¼š</span><br><span class="line">Textï¼šæ˜¾ç¤ºæ–‡æœ¬ã€‚</span><br><span class="line">Imageï¼šåŠ è½½æœ¬åœ°æˆ–ç½‘ç»œå›¾ç‰‡ã€‚</span><br><span class="line">Iconï¼šæ˜¾ç¤ºå›¾æ ‡ï¼ˆéœ€å¼•å…¥ cupertino_icons æˆ–è‡ªå®šä¹‰å›¾æ ‡åº“ï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>3.æ»šåŠ¨ç±» Widgetï¼š</strong> å¤„ç†å†…å®¹è¶…å‡ºå±å¹•æ—¶çš„æ»šåŠ¨è¡Œä¸ºã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¸¸è§æœ‰ï¼š</span><br><span class="line">ListViewï¼šå‚ç›´/æ°´å¹³æ»šåŠ¨åˆ—è¡¨ã€‚</span><br><span class="line">GridViewï¼šç½‘æ ¼å¸ƒå±€æ»šåŠ¨è§†å›¾ã€‚</span><br><span class="line">SingleChildScrollViewï¼šåŒ…è£¹å•ä¸ªå¯æ»šåŠ¨å­ç»„ä»¶ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>4.äº¤äº’ç±» Widgetï¼š</strong> å“åº”ç”¨æˆ·è¾“å…¥äº‹ä»¶ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å¸¸è§æœ‰ï¼š</span><br><span class="line">ElevatedButton/TextButtonï¼šæŒ‰é’®äº¤äº’ã€‚</span><br><span class="line">TextFieldï¼šæ–‡æœ¬è¾“å…¥æ¡†ã€‚</span><br><span class="line">Checkbox/Switchï¼šé€‰æ‹©æ§ä»¶ã€‚</span><br><span class="line">GestureDetectorï¼šè‡ªå®šä¹‰æ‰‹åŠ¿æ£€æµ‹ï¼ˆç‚¹å‡»ã€é•¿æŒ‰ã€æ‹–åŠ¨ï¼‰ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>5.å¹³å°é£æ ¼ç±» Widgetï¼š</strong> é€‚é…ä¸åŒæ“ä½œç³»ç»Ÿçš„è§†è§‰é£æ ¼ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¸¸è§æœ‰ï¼š</span><br><span class="line">Material Designï¼šMaterialAppã€AppBarã€FloatingActionButtonã€‚</span><br><span class="line">Cupertinoï¼ˆiOS é£æ ¼ï¼‰ï¼šCupertinoAppã€CupertinoNavigationBarã€CupertinoPickerã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>6.åŠ¨ç”»ç±» Widgetï¼š</strong> å®ç°åŠ¨æ€è§†è§‰æ•ˆæœã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¸¸è§æœ‰ï¼š</span><br><span class="line">AnimatedContainerï¼šè‡ªåŠ¨è¿‡æ¸¡çš„å®¹å™¨ï¼ˆå¤§å°ã€é¢œè‰²ç­‰å±æ€§å˜åŒ–ï¼‰ã€‚</span><br><span class="line">Heroï¼šé¡µé¢åˆ‡æ¢å…±äº«å…ƒç´ çš„è¿‡æ¸¡åŠ¨ç”»ã€‚</span><br><span class="line">AnimatedBuilderï¼šè‡ªå®šä¹‰å¤æ‚åŠ¨ç”»ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>7. å¯¼èˆªä¸è·¯ç”±ç±» Widgetï¼š</strong> ç®¡ç†é¡µé¢è·³è½¬å’Œå¯¼èˆªç»“æ„ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¸¸è§æœ‰ï¼š</span><br><span class="line">Navigatorï¼šç®¡ç†é¡µé¢å †æ ˆï¼ˆpush/popï¼‰ã€‚</span><br><span class="line">PageViewï¼šå®ç°æ»‘åŠ¨åˆ‡æ¢é¡µé¢ã€‚</span><br><span class="line">BottomNavigationBarï¼šåº•éƒ¨å¯¼èˆªæ ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>é€šè¿‡ç®€å• Widget ç»„åˆå®ç°å¤æ‚ UIï¼ˆä¾‹å¦‚ç”¨ Row + Expanded æ›¿ä»£è‡ªå®šä¹‰å¸ƒå±€ï¼‰(ä¼˜å…ˆç»„åˆè€Œéç»§æ‰¿)<br>å±€éƒ¨çŠ¶æ€ä½¿ç”¨ StatefulWidget<br>å…¨å±€çŠ¶æ€ä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆå¦‚ Providerã€Riverpodï¼‰<br>å¯¹é¢‘ç¹æ›´æ–°çš„éƒ¨åˆ†ä½¿ç”¨ const æ„é€ å‡½æ•°<br>é•¿åˆ—è¡¨ä½¿ç”¨ ListView.builder æ‡’åŠ è½½</p>
</blockquote>
<h2 id="3-Widget-ç”Ÿå‘½å‘¨æœŸ"><a href="#3-Widget-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3.Widget ç”Ÿå‘½å‘¨æœŸ"></a>3.Widget ç”Ÿå‘½å‘¨æœŸ</h2><p><strong>StatelessWidget çš„ç”Ÿå‘½å‘¨æœŸ</strong></p>
<blockquote>
<p>StatelessWidget ä»…æœ‰ä¸€ä¸ª build() æ–¹æ³•ï¼Œæ— çŠ¶æ€ç®¡ç†é€»è¾‘ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå®Œå…¨ç”±çˆ¶ç»„ä»¶æ§åˆ¶ã€‚</p>
</blockquote>
<p><strong>StatefulWidget ä¸»è¦ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</strong></p>
<blockquote>
<p>åˆ›å»ºé˜¶æ®µ<br>createState()</p>
</blockquote>
<blockquote>
<p>åˆå§‹åŒ–é˜¶æ®µ<br>initState()<br>didChangeDependencies()</p>
</blockquote>
<blockquote>
<p>æ›´æ–°é˜¶æ®µ<br>didUpdateWidget(oldWidget)<br>build()</p>
</blockquote>
<blockquote>
<p>é”€æ¯é˜¶æ®µ<br>deactivate()<br>dispose()</p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/img_convert/a33469c55f94b5278f698d8605d8e0cc.webp?x-oss-process=image/format,png" alt="2025-05-22 18.38.22.png"></p>
<p><strong>1.createState()</strong><br>å½“ StatefulWidget è¢«æ’å…¥ Widget æ ‘æ—¶è°ƒç”¨ï¼Œè€Œä¸”åªæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<blockquote>
<p>ä¸»è¦ç”¨äºåˆ›å»ºä¸ä¹‹å…³è”çš„ State å¯¹è±¡ï¼ˆæ¯ä¸ª Widget å¯¹åº”ä¸€ä¸ª State å®ä¾‹ï¼‰ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class MyWidget extends StatefulWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  _MyWidgetState createState() =&gt; _MyWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>2.initState()</strong><br>åœ¨ State å¯¹è±¡åˆ›å»ºåï¼Œé¦–æ¬¡è°ƒç”¨ build() ä¹‹å‰è§¦å‘è¯¥æ–¹æ³•ï¼Œè€Œä¸”åªæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<blockquote>
<p>ä¸»è¦ç”¨äºåˆå§‹åŒ–ä¾èµ–æ•°æ®ï¼ˆå¦‚è®¢é˜…äº‹ä»¶ã€åŠ è½½æœ¬åœ°é…ç½®ï¼‰å’Œ åˆ›å»ºåŠ¨ç”»æ§åˆ¶å™¨ï¼ˆAnimationControllerï¼‰ç­‰éœ€ä¸ dispose() é…å¯¹çš„èµ„æºã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void initState() &#123;</span><br><span class="line">  super.initState();</span><br><span class="line">  _controller = AnimationController(vsync: this);</span><br><span class="line">  _fetchData(); // åˆå§‹åŒ–æ•°æ®</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br><code>å¿…é¡»è°ƒç”¨ super.initState()ã€‚</code><br><code>åœ¨è¿™é‡Œ View å¹¶æ²¡æœ‰æ¸²æŸ“ï¼Œåªæ˜¯ StatefulWidget è¢«åŠ è½½åˆ°æ¸²æŸ“æ ‘é‡Œäº†ã€‚</code><br><code>é¿å…åœ¨æ­¤å¤„è§¦å‘ setStateï¼ˆå¯èƒ½å¯¼è‡´æ¸²æŸ“æœªå®Œæˆï¼‰ã€‚</code><br><code>StatefulWidgetçš„ mount çš„å€¼å˜ä¸ºäº†trueï¼ˆè°ƒç”¨dispose()æ‰ä¼šå˜ä¸º falseï¼‰ã€‚</code></p>
<p><strong>3.didChangeDependencies()</strong><br>initState() åç«‹å³è°ƒç”¨ didChangeDependencies()ã€‚<br>å½“ State ä¾èµ–çš„ InheritedWidget å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆå¦‚ä¸»é¢˜ã€æœ¬åœ°åŒ–ï¼‰ä¹Ÿä¼šè°ƒç”¨ didChangeDependencies()ã€‚</p>
<blockquote>
<p>ä¸»è¦ç”¨äºå¤„ç†ä¾èµ–å˜åŒ–åçš„é€»è¾‘ï¼ˆå¦‚é‡æ–°è¯·æ±‚ç½‘ç»œæ•°æ®ï¼‰ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void didChangeDependencies() &#123;</span><br><span class="line">  super.didChangeDependencies();</span><br><span class="line">  if (Provider.of&lt;Data&gt;(context).hasChanged) &#123;</span><br><span class="line">    _updateData();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>4. didUpdateWidget(oldWidget)</strong><br>åœ¨çˆ¶ç»„ä»¶é‡å»ºæ—¶ï¼Œè‹¥æ–°æ—§ Widget çš„ runtimeType å’Œ key ç›¸åŒè§¦å‘ didUpdateWidgetï¼ˆdidUpdateWidget æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šç”¨åˆ°ï¼‰ã€‚</p>
<blockquote>
<p>ä¸»è¦æ˜¯ï¼š<br>å¯¹æ¯”æ–°æ—§ Widget çš„é…ç½®ï¼ˆå¦‚å±æ€§å˜åŒ–ï¼‰ã€‚<br>æ ¹æ®å˜åŒ–è°ƒæ•´çŠ¶æ€ï¼ˆå¦‚é‡ç½®åŠ¨ç”»ã€æ›´æ–°ç›‘å¬ï¼‰ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void didUpdateWidget(MyWidget oldWidget) &#123;</span><br><span class="line">  super.didUpdateWidget(oldWidget);</span><br><span class="line">  if (oldWidget.color != widget.color) &#123;</span><br><span class="line">    _updateColor(); // é¢œè‰²å˜åŒ–æ—¶æ‰§è¡Œé€»è¾‘</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>5. build()</strong><br>åˆå§‹åŒ–åã€ä¾èµ–å˜åŒ–åã€setState() è°ƒç”¨åè°ƒç”¨ build()ã€‚<br>çˆ¶ç»„ä»¶æˆ–ç¥–å…ˆç»„ä»¶è§¦å‘é‡å»ºæ—¶è°ƒç”¨ build()ã€‚</p>
<blockquote>
<p>ä¸»è¦æ˜¯æ ¹æ®å½“å‰çŠ¶æ€æ„å»º UIï¼ˆä¸è¦åœ¨è¿™é‡Œåšé™¤äº†åˆ›å»º Widget ä¹‹å¤–çš„æ“ä½œï¼‰</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  return Container(</span><br><span class="line">    color: widget.color,</span><br><span class="line">    child: Text(&#x27;Count: $_count&#x27;),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br><code>å¿…é¡»è¿”å›ä¸€ä¸ª Widget</code><br><code>é¿å…åœ¨æ­¤å¤„ä¿®æ”¹çŠ¶æ€æˆ–æ‰§è¡Œè€—æ—¶æ“ä½œ</code></p>
<p><strong>6. deactivate()</strong><br>å½“ State ä»æ ‘ä¸­æš‚æ—¶ç§»é™¤ï¼ˆå¦‚é¡µé¢åˆ‡æ¢ã€ç»„ä»¶è¢«ç§»é™¤ï¼‰è§¦å‘ deactivate()ã€‚</p>
<blockquote>
<p>æ¸…ç†ä¸´æ—¶èµ„æºæˆ–ä¿å­˜ä¸´æ—¶çŠ¶æ€.</p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br><code>å¯èƒ½è¢«é‡æ–°æ’å…¥æ ‘ä¸­ï¼ˆå¦‚é¡µé¢è¿”å›æ—¶ï¼‰ï¼Œéœ€ä¸ dispose() åŒºåˆ†</code></p>
<p><strong>7. dispose()</strong><br>State è¢«æ°¸ä¹…ç§»é™¤æ—¶è°ƒç”¨ dispose()ã€‚</p>
<blockquote>
<p>é‡Šæ”¾èµ„æºï¼ˆå¦‚å–æ¶ˆç½‘ç»œè¯·æ±‚ã€é”€æ¯åŠ¨ç”»æ§åˆ¶å™¨ï¼‰</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void dispose() &#123;</span><br><span class="line">  _controller.dispose(); // é”€æ¯åŠ¨ç”»æ§åˆ¶å™¨</span><br><span class="line">  _subscription.cancel(); // å–æ¶ˆäº‹ä»¶è®¢é˜…</span><br><span class="line">  super.dispose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br><code>å¦‚æœåœ¨ dispose() ä¸­æœªé‡Šæ”¾èµ„æºï¼ˆå¦‚åŠ¨ç”»æ§åˆ¶å™¨ã€Stream è®¢é˜…ï¼‰å¯èƒ½é€ æˆå†…å­˜æ³„æ¼</code><br><code>å¦‚æœåœ¨ dispose() åè°ƒç”¨ setState ä¼šå¯¼è‡´å¼‚å¸¸</code></p>
<h2 id="4-Widget-çš„æ¸²æŸ“"><a href="#4-Widget-çš„æ¸²æŸ“" class="headerlink" title="4.Widget çš„æ¸²æŸ“"></a>4.Widget çš„æ¸²æŸ“</h2><p><strong>æ¸²æŸ“æµç¨‹ï¼š</strong><br>Flutter çš„æ¸²æŸ“ç³»ç»ŸåŸºäºä¸‰æ£µæ ¸å¿ƒæ ‘ç»“æ„ï¼Œé€šè¿‡é«˜åº¦ä¼˜åŒ–çš„ç®¡çº¿ï¼ˆPipelineï¼‰å®ç°é«˜æ•ˆçš„ UI æ›´æ–°ã€‚</p>
<blockquote>
<p><strong>Widget é‡å»º â†’ Diff æ–°æ—§ Widget æ ‘ â†’ æ›´æ–° Element æ ‘ â†’ æ›´æ–° RenderObject æ ‘ â†’ è§¦å‘ Layer åˆæˆ â†’ å±å¹•åˆ·æ–°</strong></p>
</blockquote>
<p><strong>1.Widget æ ‘çš„æ„å»ºï¼š</strong></p>
<blockquote>
<p>æè¿° UI çš„ä¸å¯å˜é…ç½®ï¼Œç”±å¼€å‘è€…åˆ›å»ºï¼Œé¢‘ç¹é‡å»ºï¼Œéœ€è½»é‡åŒ–ã€‚<br>å¼€å‘è€…ç¼–å†™çš„ Widget ä»£ç è¢«è½¬åŒ–ä¸ºåµŒå¥—çš„ Widget æ ‘ï¼ˆåº”ç”¨çš„å…¥å£æ˜¯æ ¹ Widgetï¼Œä¸€èˆ¬æ˜¯ MaterialApp æˆ– CupertinoAppã€‚æ ¹ Widget ä¼šé€’å½’åœ°æ„å»ºå…¶å­ Widgetï¼Œå½¢æˆä¸€æ£µæ ‘ã€‚ï¼‰ã€‚<br>å…·æœ‰ä¸å¯å˜æ€§ï¼Œæ¯æ¬¡é‡å»ºç”Ÿæˆå…¨æ–°çš„ Widget æ ‘ï¼Œä½†é€šè¿‡ Diff ç®—æ³•å¯ä»¥ä¼˜åŒ–å®é™…æ›´æ–°èŒƒå›´ã€‚</p>
</blockquote>
<p><strong>2. Element æ ‘çš„ Diff ä¸æ›´æ–°</strong></p>
<blockquote>
<p>æ ¹æ® Widget æ ‘ç”Ÿæˆä¸€ä¸ª Element æ ‘ï¼ŒElement æ ‘ä¸­çš„èŠ‚ç‚¹éƒ½ç»§æ‰¿è‡ª Element ç±»ã€‚<br>Element æ˜¯ Widget çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œè´Ÿè´£ç®¡ç† çŠ¶æ€ï¼ˆStateï¼‰ å’Œ å­èŠ‚ç‚¹å¼•ç”¨ã€‚<br>æ¯ä¸ª Widget éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„ Element å¯¹è±¡ï¼Œç”¨äºç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸã€‚</p>
</blockquote>
<blockquote>
<p>Diff ç®—æ³•ï¼šFlutter å¯¹æ¯”æ–°æ—§ Widget æ ‘ï¼Œä»…æ›´æ–°å˜åŒ–çš„ Element å’Œ RenderObjectï¼Œç±»ä¼¼ React çš„è™šæ‹Ÿ DOMã€‚<br>å½“ Widget æ ‘é‡å»ºæ—¶ï¼ŒFlutter é€šè¿‡ Diff ç®—æ³• å¯¹æ¯”æ–°æ—§ Widget æ ‘ï¼Œå†³å®š Element æ ‘çš„æ›´æ–°ç­–ç•¥<br>Reuseï¼šè‹¥æ–°æ—§ Widget çš„ runtimeType å’Œ key ç›¸åŒï¼Œå¤ç”¨ç°æœ‰ Elementã€‚<br>Updateï¼šæ›´æ–° Element çš„é…ç½®ï¼ˆè°ƒç”¨ Element.update(newWidget)ï¼‰ã€‚<br>Replaceï¼šç±»å‹æˆ– Key ä¸åŒæ—¶ï¼Œé”€æ¯æ—§ Elementï¼Œåˆ›å»ºæ–° Elementã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// æ—§ Widget æ ‘</span><br><span class="line">Container(color: Colors.red)</span><br><span class="line"></span><br><span class="line">// æ–° Widget æ ‘</span><br><span class="line">Container(color: Colors.blue)</span><br><span class="line"></span><br><span class="line">// Diff ç»“æœï¼šContainer ç±»å‹ç›¸åŒä¸”æ—  Key â†’ å¤ç”¨ Elementï¼Œæ›´æ–° RenderObject é¢œè‰²</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// Element æ›´æ–°é€»è¾‘</span><br><span class="line">Element.updateChild()</span><br><span class="line"></span><br><span class="line">Element updateChild(Element child, Widget newWidget, dynamic newSlot) &#123;</span><br><span class="line">  if (newWidget == null) &#123;</span><br><span class="line">    // ç§»é™¤å­èŠ‚ç‚¹</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">  if (child != null) &#123;</span><br><span class="line">    if (child.widget == newWidget) &#123;</span><br><span class="line">      // Widget æœªå˜åŒ– â†’ å¤ç”¨ Element</span><br><span class="line">      return child;</span><br><span class="line">    &#125;</span><br><span class="line">    if (Widget.canUpdate(child.widget, newWidget)) &#123;</span><br><span class="line">      // æ›´æ–° Element é…ç½®</span><br><span class="line">      child.update(newWidget);</span><br><span class="line">      return child;</span><br><span class="line">    &#125;</span><br><span class="line">    // é”€æ¯æ—§ Elementï¼Œåˆ›å»ºæ–° Element</span><br><span class="line">    deactivateChild(child);</span><br><span class="line">  &#125;</span><br><span class="line">  return inflateWidget(newWidget, newSlot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3. RenderObject æ ‘çš„æ›´æ–°</strong></p>
<p>æ›´æ–° RenderObject æ ‘ï¼Œè®¡ç®—å¸ƒå±€å’Œç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤ã€‚<br>è¿è¡Œåœ¨ UI Threadã€‚</p>
<blockquote>
<p>æ ¹æ® Element æ ‘ç”Ÿæˆ Render æ ‘ï¼ˆæ¸²æŸ“æ ‘ï¼‰ï¼Œæ¸²æŸ“æ ‘ä¸­çš„èŠ‚ç‚¹éƒ½ç»§æ‰¿è‡ª RenderObject ç±»ã€‚<br>æ¯ä¸ª Element å¯¹åº”ä¸€ä¸ª RenderObjectï¼ˆé€šè¿‡ Element.createRenderObject() åˆ›å»ºï¼‰ã€‚</p>
</blockquote>
<blockquote>
<p>æ ¹æ®çˆ¶ RenderObject ä¼ é€’çš„ çº¦æŸï¼ˆConstraintsï¼‰ï¼Œè®¡ç®—è‡ªèº«å°ºå¯¸å’Œä½ç½®ã€‚<br>é€’å½’è°ƒç”¨å­èŠ‚ç‚¹çš„ layout() æ–¹æ³•ï¼ˆæ·±åº¦ä¼˜å…ˆéå†ï¼‰ã€‚</p>
</blockquote>
<p><strong>å¸ƒå±€ï¼ˆLayoutï¼‰æ ¸å¿ƒæ–¹æ³•ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// RenderObject å¸ƒå±€æµç¨‹</span><br><span class="line">RenderObject.layout()</span><br><span class="line"></span><br><span class="line">void layout(Constraints constraints, &#123; bool parentUsesSize = false &#125;) &#123;</span><br><span class="line">  _constraints = constraints;</span><br><span class="line">  if (_relayoutBoundary != this) &#123;</span><br><span class="line">    markNeedsLayout();</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  performLayout();  // 1. è®¡ç®—è‡ªèº«å°ºå¯¸ï¼ˆè°ƒç”¨ performLayoutï¼‰ ç”±å­ç±»å®ç°å…·ä½“å¸ƒå±€é€»è¾‘</span><br><span class="line">  _needsLayout = false;</span><br><span class="line">  markNeedsPaint(); // æ ‡è®°éœ€è¦é‡ç»˜</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤ï¼ˆå¦‚å½¢çŠ¶ã€é¢œè‰²ã€æ–‡æœ¬ï¼‰ï¼Œå†™å…¥ Layerï¼ˆåˆæˆå±‚ï¼‰ã€‚</p>
</blockquote>
<p><strong>ç»˜åˆ¶ï¼ˆPaintï¼‰æ ¸å¿ƒæ–¹æ³•:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">void paint(PaintingContext context, Offset offset) &#123;</span><br><span class="line">  // ç»˜åˆ¶é€»è¾‘ï¼Œå¦‚ç”»çŸ©å½¢</span><br><span class="line">  context.canvas.drawRect(rect, paint);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>4. åˆæˆä¸å…‰æ …åŒ–ï¼ˆComposition &amp; Rasterizationï¼‰</strong></p>
<p>ç”Ÿæˆ Layer æ ‘å¹¶å…‰æ …åŒ–ã€‚<br>è¿è¡Œåœ¨ Raster Threadï¼ˆä¸ UI Thread å¹¶è¡Œï¼‰</p>
<blockquote>
<p>æ ¹æ®æ¸²æŸ“æ ‘ç”Ÿæˆ Layer æ ‘ï¼Œç„¶åä¸Šå±æ˜¾ç¤ºï¼ŒLayer æ ‘ä¸­çš„èŠ‚ç‚¹éƒ½ç»§æ‰¿è‡ª Layer ç±»ã€‚<br>RenderObject çš„ç»˜åˆ¶ç»“æœè¢«ç»„ç»‡ä¸º Layer æ ‘ï¼Œæ¯ä¸ª Layer å¯¹åº”ä¸€ä¸ª GPU çº¹ç†ï¼ˆTextureï¼‰ã€‚è‡ªæ­¤ Layer æ ‘ç”Ÿæˆã€‚<br>ç±»å‹åŒ…æ‹¬ï¼šPictureLayerï¼ˆçŸ¢é‡ç»˜åˆ¶ï¼‰ã€TextureLayerï¼ˆå›¾åƒçº¹ç†ï¼‰ã€TransformLayerï¼ˆå˜æ¢æ•ˆæœï¼‰ç­‰ã€‚</p>
</blockquote>
<blockquote>
<p>å°† Layer æ ‘ä¸­çš„ç»˜åˆ¶æŒ‡ä»¤è½¬æ¢ä¸º GPU å¯è¯†åˆ«çš„ä½å›¾æ•°æ®ã€‚<br>é€šè¿‡ Skia å›¾å½¢åº“ï¼ˆæˆ– Impellerï¼‰å®Œæˆï¼Œæœ€ç»ˆæäº¤ç»™ GPU æ¸²æŸ“ã€‚ï¼ˆå®Œæˆå…‰æ …åŒ–ï¼ˆRaster Threadï¼‰ï¼‰ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">void paintChild(RenderObject child, Offset offset) &#123;</span><br><span class="line">  if (child.isRepaintBoundary) &#123;</span><br><span class="line">    // åˆ›å»ºç‹¬ç«‹ Layer</span><br><span class="line">    stopRecordingIfNeeded();</span><br><span class="line">    child._layer = OffsetLayer();</span><br><span class="line">    appendLayer(child._layer);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    child._paintWithContext(this, offset);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>5. GPU æ¸²æŸ“ä¸å±å¹•åˆ·æ–°</strong></p>
<blockquote>
<p><strong>å‚ç›´åŒæ­¥ï¼ˆVSyncï¼‰ï¼š</strong><br>ç”±ç³»ç»Ÿå®šæ—¶è§¦å‘çš„ä¿¡å·ï¼Œæ§åˆ¶å¸§ç‡ï¼ˆå¦‚ 60Hz â†’ 16.6ms&#x2F;å¸§ï¼‰ã€‚<br>Flutter å¼•æ“åœ¨ VSync ä¿¡å·åˆ°æ¥æ—¶ï¼Œæäº¤å…‰æ …åŒ–åçš„å¸§æ•°æ®åˆ° GPUã€‚</p>
</blockquote>
<blockquote>
<p><strong>å±å¹•æ˜¾ç¤ºï¼š</strong><br>GPU å°†å¸§æ•°æ®å†™å…¥å¸§ç¼“å†²åŒºï¼ˆFrame Bufferï¼‰ï¼Œå±å¹•ç¡¬ä»¶æŒ‰åˆ·æ–°ç‡è¯»å–å¹¶æ˜¾ç¤ºã€‚</p>
</blockquote>
<h2 id="5-Widget-ä¼˜åŒ–"><a href="#5-Widget-ä¼˜åŒ–" class="headerlink" title="5.Widget ä¼˜åŒ–"></a>5.Widget ä¼˜åŒ–</h2><p><code>é«˜æ€§èƒ½æ¸²æŸ“ = æœ€å°åŒ– Widget Diff + é«˜æ•ˆå¸ƒå±€/ç»˜åˆ¶ + GPU çº¿ç¨‹ä¼˜åŒ–</code></p>
<blockquote>
<p>Flutter ä¼˜åŒ–çš„æœ¬è´¨æ˜¯ å‡å°‘æ— æ•ˆè®¡ç®— å’Œ é™ä½ GPU è´Ÿè½½<br>ä¸€èˆ¬å›´ç»•å››ä¸ªæ–¹å‘ï¼š 1.æœ€å°åŒ– Widget æ ‘ Diff èŒƒå›´ 2.å‡å°‘å¸ƒå±€ï¼ˆLayoutï¼‰å’Œç»˜åˆ¶ï¼ˆPaintï¼‰è®¡ç®— 3.ä¼˜åŒ– GPU åˆæˆä¸å…‰æ …åŒ–ï¼ˆRasterizationï¼‰ 4.é«˜æ•ˆç®¡ç†çŠ¶æ€ä¸èµ„æº</p>
</blockquote>
<blockquote>
<p><strong>æ€§èƒ½åˆ†æå·¥å…·</strong><br>Flutter DevToolsï¼š<br>Performance é¢æ¿ï¼šåˆ†æ UI&#x2F;Raster çº¿ç¨‹çš„å¸§è€—æ—¶ã€‚<br>Layer æŸ¥çœ‹å™¨ï¼šæ£€æµ‹ Layer åˆæˆæ˜¯å¦åˆç†ã€‚<br>debugProfileBuildsEnabledï¼šè¿½è¸ª Widget æ„å»ºè€—æ—¶<br>è°ƒè¯•æ ‡è®°ï¼š<br>debugPrintMarkNeedsLayoutStacksï¼šæ‰“å°è§¦å‘å¸ƒå±€çš„å †æ ˆä¿¡æ¯ã€‚<br>debugPaintLayerBordersEnabledï¼šå¯è§†åŒ– Layer è¾¹ç•Œã€‚</p>
</blockquote>
<p><strong>1.Widget æ ‘ Diff ä¼˜åŒ–</strong></p>
<blockquote>
<p><strong>Diff ç®—æ³•æœºåˆ¶ï¼š</strong> å½“çˆ¶ç»„ä»¶æ›´æ–°æ—¶ï¼ŒFlutter é€’å½’å¯¹æ¯”æ–°æ—§ Widget æ ‘ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–° Element å’Œ RenderObjectã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">static bool canUpdate(Widget oldWidget, Widget newWidget) &#123;</span><br><span class="line">  return oldWidget.runtimeType == newWidget.runtimeType</span><br><span class="line">      &amp;&amp; oldWidget.key == newWidget.key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>å¤ç”¨æ¡ä»¶ï¼š</strong> runtimeType å’Œ key ç›¸åŒ â†’ å¤ç”¨ Elementï¼Œä»…æ›´æ–°é…ç½®ã€‚<br><strong>æ›¿æ¢æ¡ä»¶ï¼š</strong> ç±»å‹æˆ– Key ä¸åŒ â†’ é”€æ¯æ—§ Elementï¼Œåˆ›å»ºæ–° Elementã€‚</p>
</blockquote>
<p><strong>ä¼˜åŒ–ç­–ç•¥ï¼š</strong><br><strong>1.ä½¿ç”¨ const æ„é€ å‡½æ•°ï¼š</strong> const Widget åœ¨å¤šæ¬¡é‡å»ºä¸­å¼•ç”¨åŒä¸€å†…å­˜åœ°å€ï¼ŒWidget.canUpdate ç›´æ¥è¿”å› trueï¼Œè·³è¿‡ Diff è®¡ç®—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const MyWidget(text: &#x27;Hello&#x27;); // âœ… ä¼˜åŒ–</span><br><span class="line">MyWidget(text: &#x27;Hello&#x27;);      // âŒ é const</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>2.åˆç†ä½¿ç”¨ Keyï¼š</strong> ValueKeyï¼šåœ¨åˆ—è¡¨é¡¹ä¸­æ ‡è¯†å”¯ä¸€æ€§ï¼Œé¿å…é”™è¯¯å¤ç”¨å¯¼è‡´çŠ¶æ€æ··ä¹±ã€‚<br>GlobalKeyï¼šè·¨ç»„ä»¶è®¿é—®çŠ¶æ€ï¼ˆè°¨æ…ä½¿ç”¨ï¼Œç ´åå±€éƒ¨æ€§ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ListView.builder(</span><br><span class="line">  itemBuilder: (_, index) =&gt; ItemWidget(</span><br><span class="line">    key: ValueKey(items[index].id), // å”¯ä¸€æ ‡è¯†</span><br><span class="line">    data: items[index],</span><br><span class="line">  ),</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3.æ‹†åˆ†ç»†ç²’åº¦ Widgetï¼š</strong> å°†é¢‘ç¹å˜åŒ–çš„éƒ¨åˆ†æ‹†åˆ†ä¸ºç‹¬ç«‹ Widgetï¼Œç¼©å° setState è§¦å‘çš„ Diff èŒƒå›´ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// çˆ¶ç»„ä»¶ï¼ˆä»…ä¼ é€’é™æ€æ•°æ®ï¼‰</span><br><span class="line">class ParentWidget extends StatelessWidget &#123;</span><br><span class="line">  const ParentWidget(&#123;super.key&#125;);</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Column(</span><br><span class="line">      children: [</span><br><span class="line">        const StaticHeader(), // é™æ€éƒ¨åˆ†</span><br><span class="line">        DynamicContent(data: _data), // åŠ¨æ€éƒ¨åˆ†</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>2.å¸ƒå±€ï¼ˆLayoutï¼‰é˜¶æ®µä¼˜åŒ–</strong></p>
<blockquote>
<p><strong>å¸ƒå±€è®¡ç®—æœºåˆ¶ï¼š</strong> å½“æŸä¸ª RenderObject çš„å°ºå¯¸å˜åŒ–ä¸å½±å“çˆ¶èŠ‚ç‚¹å¸ƒå±€æ—¶ï¼Œå¯æ ‡è®°ä¸ºå¸ƒå±€è¾¹ç•Œï¼Œé˜»æ–­å¸ƒå±€è®¡ç®—å‘ä¸Šä¼ æ’­ã€‚é€šè¿‡ RenderObject.isRepaintBoundary &#x3D; true è®¾ç½®ï¼ˆå¸ƒå±€è¾¹ç•Œï¼ˆRelayout Boundaryï¼‰ï¼‰</p>
</blockquote>
<blockquote>
<p>çˆ¶èŠ‚ç‚¹ä¼ é€’ çº¦æŸï¼ˆConstraintsï¼‰ ç»™å­èŠ‚ç‚¹<br>å­èŠ‚ç‚¹æ ¹æ®çº¦æŸè®¡ç®—è‡ªèº«å°ºå¯¸ï¼Œå¹¶é€’å½’å¸ƒå±€å­èŠ‚ç‚¹(å¸ƒå±€è¿‡ç¨‹)</p>
</blockquote>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong></p>
<blockquote>
<p><strong>1.é¿å…è¿‡åº¦åµŒå¥—ï¼š</strong> å¤šå±‚ Row&#x2F;Column ä¼šå¯¼è‡´å¸ƒå±€è®¡ç®—å¤æ‚åº¦å‘ˆæŒ‡æ•°å¢é•¿ã€‚<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Flexã€Wrap æˆ–è‡ªå®šä¹‰å¸ƒå±€é€»è¾‘æ›¿ä»£åµŒå¥—ã€‚</p>
</blockquote>
<blockquote>
<p><strong>2.é¢„è®¡ç®—å°ºå¯¸ï¼š</strong> é€šè¿‡å›ºå®šå°ºå¯¸ï¼ˆSizedBoxï¼‰æˆ– LayoutBuilder æå‰ç¡®å®šå¸ƒå±€çº¦æŸï¼Œå‡å°‘è®¡ç®—é‡ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SizedBox(</span><br><span class="line">  width: 100,</span><br><span class="line">  height: 50,</span><br><span class="line">  child: Text(&#x27;Fixed Size&#x27;),</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>3.ä½¿ç”¨ IntrinsicWidth&#x2F;IntrinsicHeight çš„æ›¿ä»£æ–¹æ¡ˆï¼š</strong> IntrinsicWidth ä¼šè§¦å‘å¤šæ¬¡å­èŠ‚ç‚¹å¸ƒå±€è®¡ç®—ï¼Œæ€§èƒ½ä½ä¸‹ã€‚<br>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¡ç®—å­èŠ‚ç‚¹æœ€å¤§å®½åº¦ï¼Œä½¿ç”¨ ConstrainedBox é™åˆ¶å°ºå¯¸ã€‚</p>
</blockquote>
<p><strong>3.ç»˜åˆ¶ï¼ˆPaintï¼‰é˜¶æ®µä¼˜åŒ–</strong></p>
<blockquote>
<p><strong>ç»˜åˆ¶æœºåˆ¶ï¼š</strong> å½“ RenderObject çš„è§†è§‰å±æ€§ï¼ˆå¦‚é¢œè‰²ã€ä½ç½®ï¼‰å˜åŒ–æ—¶ï¼Œè°ƒç”¨ markNeedsPaint() æ ‡è®°éœ€è¦é‡ç»˜ã€‚</p>
</blockquote>
<blockquote>
<p><strong>åˆæˆå±‚ï¼ˆLayerï¼‰ï¼š</strong> æ¯ä¸ª RenderObject çš„ç»˜åˆ¶ç»“æœè¢«ç»„ç»‡ä¸º Layer æ ‘ï¼Œæœ€ç»ˆç”± GPU å…‰æ …åŒ–ã€‚ï¼ˆPictureLayerï¼ˆçŸ¢é‡ç»˜åˆ¶ï¼‰ã€TextureLayerï¼ˆå›¾åƒï¼‰ã€TransformLayerï¼ˆå˜æ¢ï¼‰ï¼‰ã€‚</p>
</blockquote>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong></p>
<blockquote>
<p><strong>1.ä½¿ç”¨ RepaintBoundaryï¼š</strong> å°†ç‹¬ç«‹å˜åŒ–çš„ UI éƒ¨åˆ†åŒ…è£¹ RepaintBoundaryï¼Œç”Ÿæˆç‹¬ç«‹ Layerï¼Œå‡å°‘é‡ç»˜åŒºåŸŸã€‚<br>é€šè¿‡ RenderObject.isRepaintBoundary &#x3D; true æ ‡è®°ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RepaintBoundary(</span><br><span class="line">  child: MyAnimatedWidget(), // ç‹¬ç«‹é‡ç»˜åŒºåŸŸ</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>2.é¿å…é«˜å¼€é”€ç»˜åˆ¶æ“ä½œï¼š</strong> ä½¿ç”¨ AnimatedOpacity æˆ–ç›´æ¥è®¾ç½®é¢œè‰²é€æ˜åº¦ï¼ˆColor.withOpacityï¼‰æ›¿ä»£ Opacity ã€‚<br>ä¼˜å…ˆä½¿ç”¨ ClipRect æˆ– ClipRRectï¼Œå‡å°‘è·¯å¾„è£å‰ªçš„è®¡ç®—é‡ã€‚</p>
</blockquote>
<blockquote>
<p><strong>3.è‡ªå®šä¹‰ç»˜åˆ¶ä¼˜åŒ–ï¼š</strong> åœ¨ CustomPainter ä¸­ç²¾ç¡®æ§åˆ¶é‡ç»˜æ¡ä»¶ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class MyPainter extends CustomPainter &#123;</span><br><span class="line">  @override</span><br><span class="line">  bool shouldRepaint(MyPainter old) &#123;</span><br><span class="line">    return old.color != color; // ä»…é¢œè‰²å˜åŒ–æ—¶é‡ç»˜</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>4.GPU åˆæˆä¸å…‰æ …åŒ–ä¼˜åŒ–</strong></p>
<blockquote>
<p><strong>1.å…‰æ …åŒ–æœºåˆ¶ï¼š</strong> é€šè¿‡ä¸Šé¢çš„åˆæˆä¸å…‰æ …åŒ–å¯çŸ¥é“ï¼šå…‰æ …åŒ–è¿è¡Œåœ¨ç‹¬ç«‹çš„ Raster Threadï¼Œä¸ UI Thread å¹¶è¡Œã€‚<br>Flutter è‡ªåŠ¨å¤ç”¨æœªå˜åŒ–çš„ Layer å¯¹åº”çš„ GPU çº¹ç†ï¼Œå‡å°‘æ•°æ®ä¼ è¾“ã€‚ï¼ˆçº¹ç†ï¼ˆTextureï¼‰å¤ç”¨ï¼‰</p>
</blockquote>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong></p>
<blockquote>
<p><strong>1.å‡å°‘ Layer æ•°é‡ï¼š</strong> è¿‡å¤šçš„ Layer ä¼šå¢åŠ  GPU åˆæˆå¼€é”€ï¼Œæˆ‘ä»¬éœ€è¦å°½å¯èƒ½çš„åˆå¹¶ç›¸é‚»çš„ PictureLayerï¼Œé¿å…ä¸å¿…è¦çš„ Opacity æˆ– Transform åµŒå¥—ã€‚</p>
</blockquote>
<blockquote>
<p><strong>2.ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿæ“ä½œï¼š</strong> åˆ©ç”¨ GPU çš„çŸ©é˜µå˜æ¢ç¡¬ä»¶åŠ é€Ÿï¼ˆTransform æ›¿ä»£æ‰‹åŠ¨çŸ©é˜µè®¡ç®—ï¼‰ã€‚<br>å¯¹é‡å¤ä½¿ç”¨çš„å›¾ç‰‡æå‰è§£ç ï¼ˆprecacheImageï¼‰ ï¼ˆImage é¢„åŠ è½½ï¼‰ã€‚</p>
</blockquote>
<blockquote>
<p><strong>3.å¯ç”¨ Impeller å¼•æ“ï¼š</strong> Flutter 3.0+ å¼•å…¥çš„ Impeller å¼•æ“é’ˆå¯¹ GPU è´Ÿè½½ä¼˜åŒ–ï¼Œå‡å°‘å…‰æ …åŒ–æŠ–åŠ¨ã€‚</p>
</blockquote>
<p><strong>5.çŠ¶æ€ç®¡ç†ä¸èµ„æºä¼˜åŒ–</strong></p>
<blockquote>
<p><strong>1.çŠ¶æ€ç®¡ç†ï¼š</strong><br>å±€éƒ¨çŠ¶æ€ï¼šä½¿ç”¨ StatefulWidget ç®¡ç†ï¼Œç¡®ä¿ dispose() é‡Šæ”¾èµ„æºã€‚<br>å…¨å±€çŠ¶æ€ï¼šé‡‡ç”¨ Providerã€Riverpod æˆ– Blocï¼Œé¿å…çŠ¶æ€ç©¿é€å’Œå†—ä½™é‡å»ºã€‚</p>
</blockquote>
<blockquote>
<p><strong>2.èµ„æºé‡Šæ”¾ï¼š</strong><br>å¿…é¡»é‡Šæ”¾åŠ¨ç”»æ§åˆ¶å™¨ï¼ˆAnimationController.dispose()ï¼‰ã€Stream è®¢é˜…ï¼ˆSubscription.cancel()ï¼‰ç­‰èµ„æºã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void dispose() &#123;</span><br><span class="line">  _controller.dispose();</span><br><span class="line">  _streamSubscription.cancel();</span><br><span class="line">  super.dispose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/img_convert/58ae194fbfc28292a73f2130d949f78a.webp?x-oss-process=image/format,png" alt="2025-05-23 14.45.52.png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CFlutter%E2%80%9D/" rel="tag">â€œFlutterâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CWidget%E2%80%9D/" rel="tag">â€œWidgetâ€</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="[layout]-flutter-error"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2025/05/23/flutter-error/"
    >Flutteré‡åˆ°çš„é—®é¢˜</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2025/05/23/flutter-error/" class="article-date">
  <time datetime="2025-05-23T07:17:44.000Z" itemprop="datePublished">2025-05-23</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Flutter/">Flutter</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p><strong>1.Flutter In ios 14+,debug mode Flutter apps can only be launched from Flutter toolingã€‚<br>åŸå› ï¼šDebugæ¨¡å¼ä¸‹ï¼ŒFlutterä¹Ÿå®ç°äº†çƒ­é‡è½½ï¼Œé»˜è®¤ç¼–è¯‘æ–¹å¼ä¸ºJITè€ŒiOS 14+ç³»ç»Ÿå¯¹è¿™ç§ç¼–è¯‘æ¨¡å¼åšäº†é™åˆ¶ï¼Œå¯¼è‡´æ— æ³•å¯åŠ¨ã€‚</strong></p>
</blockquote>
<p>è§£å†³åŠæ³•å¦‚ä¸‹ï¼šç”¨ [Xcode] æ‰“å¼€Flutteré‡Œé¢Runnerå·¥ç¨‹é¡¹ç›®ï¼Œåœ¨ Build Settings çš„æœ€ä¸‹æ–¹æ‰¾åˆ° User-Definedï¼Œç‚¹å‡» + æŒ‰é’®ï¼Œæ·»åŠ ä¸€ä¸ªé”®ä¸º FLUTTER_BUILD_MODE ï¼Œdebugè®¾ç½®profileæ¨¡å¼ï¼Œreleaseè®¾ç½®release æ¨¡å¼ï¼š<img src="https://i-blog.csdnimg.cn/img_convert/7f789a7b66202aa3d5d577d4ff7a4b51.webp?x-oss-process=image/format,png" alt="æˆªå±2024-03-14 11.27.00.png">{target&#x3D;â€_blankâ€}</p>
<blockquote>
<p><strong>2.å°† flutter æ¨¡å— åµŒå…¥iOSå·¥ç¨‹ä¸­ï¼Œç¼–è¯‘æ—¶æŠ¥é”™ï¼šFailed to package ã€‚ã€‚ã€‚ã€‚flutterä»£ç è·¯å¾„ã€‚ã€‚ã€‚ã€‚ã€‚Command PhaseScriptExecution failed with a nonzero exit code</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/ad21f4b3e2a82eb701e1e9363f00d885.webp?x-oss-process=image/format,png" alt="æˆªå±2024-03-14 11.28.18.png">{target&#x3D;â€_blankâ€}</p>
</blockquote>
<p>è§£å†³åŠæ³•å¦‚ä¸‹ï¼š<br><strong>1.ç¡®ä¿flutteré¡¹ç›®ä»£ç ä¸­æ²¡æœ‰é”™è¯¯</strong><br><strong>2.é‡æ–°æ„å»ºé¡¹ç›®ï¼š</strong><br><strong>flutter clean</strong><br><strong>2.flutter pub getï¼ˆè·å–è¿œç¨‹åº“,ç¡®å®šå½“å‰åº”ç”¨æ‰€ä¾èµ–çš„åŒ…ï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åˆ°ä¸­å¤®ç³»ç»Ÿç¼“å­˜ï¼ˆcentral system cacheï¼‰ä¸­ï¼‰</strong><br><strong>3.flutter run</strong></p>
<blockquote>
<p><strong>3.å‡çº§flutterï¼šflutter upgrade â€“force æŠ¥é”™</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/ed59f544c4becaac4c167e3128af66ca.webp?x-oss-process=image/format,png" alt="æˆªå±2024-09-12 15.23.05.png">{target&#x3D;â€_blankâ€}</p>
</blockquote>
<p>Flutter Channelç‰ˆæœ¬é€‰æ‹©<br>Flutteræä¾›äº†Stableã€Betaã€Devå’ŒMasterå››ç§ç‰ˆæœ¬ï¼Œæ¯ç§ç‰ˆæœ¬éƒ½æœ‰å…¶ç‰¹å®šçš„ç”¨é€”å’Œç¨³å®šæ€§ï¼š<br>Stableï¼šæœ€ç¨³å®šçš„ç‰ˆæœ¬ï¼Œæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒã€‚<br>Betaï¼šç›¸å¯¹è¾ƒç¨³å®šï¼Œä½†ä»å¯èƒ½å­˜åœ¨ä¸€äº›å·²çŸ¥é—®é¢˜ã€‚<br>Devï¼šç»è¿‡Googleæµ‹è¯•åçš„æœ€æ–°ç‰ˆæœ¬ï¼ŒåŒ…å«æ–°åŠŸèƒ½å’Œæ”¹è¿›ã€‚<br>Masterï¼šæœ€æ–°çš„ä»£ç ä¸»åˆ†æ”¯ï¼Œæ›´æ–°é€Ÿåº¦éå¸¸å¿«ï¼Œå‡ ä¹æ¯å¤©éƒ½æœ‰æäº¤ï¼Œæ–°åŠŸèƒ½å¤šä½†å¯èƒ½ä¸ç¨³å®šã€‚<br>å¼€å‘Flutteré¡¹ç›®æ—¶ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨Stableç‰ˆæœ¬ï¼Œä»¥ç¡®ä¿é¡¹ç›®çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å¦‚éœ€ä½¿ç”¨æŸäº›å°šæœªåœ¨Stableç‰ˆæœ¬ä¸­æ”¯æŒçš„åŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Betaæˆ–Devç‰ˆæœ¬ã€‚Masterç‰ˆæœ¬åˆ™æ›´é€‚åˆäºé‚£äº›å¸Œæœ›å°è¯•æœ€æ–°åŠŸèƒ½å¹¶æ„¿æ„æ‰¿å—æ½œåœ¨ä¸ç¨³å®šæ€§çš„å¼€å‘è€…ã€‚</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CError%E2%80%9D/" rel="tag">â€œErrorâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CFlutter%E2%80%9D/" rel="tag">â€œFlutterâ€</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="[layout]-é¡¹ç›®å‰–æ04-swift-ç½‘ç»œè¯·æ±‚Moya-Alamofire-HTTPS-è¯ä¹¦éªŒè¯"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2024/03/05/%E9%A1%B9%E7%9B%AE%E5%89%96%E6%9E%9004-swift-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82Moya-Alamofire-HTTPS-%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81/"
    >é¡¹ç›®å‰–æ04-swift ç½‘ç»œè¯·æ±‚Moya+Alamofire(HTTPS)è¯ä¹¦éªŒè¯</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/03/05/%E9%A1%B9%E7%9B%AE%E5%89%96%E6%9E%9004-swift-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82Moya-Alamofire-HTTPS-%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81/" class="article-date">
  <time datetime="2024-03-05T08:02:13.000Z" itemprop="datePublished">2024-03-05</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/swift/">swift</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="SSLè¯ä¹¦éªŒè¯"><a href="#SSLè¯ä¹¦éªŒè¯" class="headerlink" title="SSLè¯ä¹¦éªŒè¯"></a>SSLè¯ä¹¦éªŒè¯</h2><p><strong>ä¸€ç§åŠ å¼ºApp å’Œ Server é—´é€šè®¯å®‰å…¨çš„æ–¹æ³•ã€‚ä¸»è¦ç›®æ ‡æ˜¯ç¡®ä¿ App ä»…ä¸é¢„å…ˆéªŒè¯çš„ Server å»ºç«‹å®‰å…¨è¿æ¥ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-Middleï¼ŒMitMï¼‰ç­‰å®‰å…¨é£é™©ã€‚ä¸€èˆ¬å¸¸ç”¨çš„æœ‰ä¸¤ç§æ–¹å¼è¿›è¡ŒéªŒè¯ï¼ŒCertificate Pinningå’ŒPublic Key Pinningã€‚</strong></p>
<blockquote>
<p>Alamofire5.0 ä»¥åå°†è¯ä¹¦éªŒè¯ç±»æ”¾äºServerTrustEvaluationè¿™ä¸ªç±»é‡Œé¢ã€‚ä¸€å…±æœ‰6ç§éªŒè¯ç­–ç•¥ï¼š</p>
<ol>
<li><p><strong>DefaultTrustEvaluator</strong> - ï¼ˆé»˜è®¤éªŒè¯ç­–ç•¥ï¼‰åªè¦æ˜¯åˆæ³•è¯ä¹¦å°±èƒ½é€šè¿‡éªŒè¯ã€‚</p>
</li>
<li><p><strong>RevocationTrustEvaluator</strong>ï¼ˆéªŒè¯æ³¨é”€ç­–ç•¥ï¼‰å¯¹æ³¨é”€è¯ä¹¦åšçš„ä¸€ç§é¢å¤–è®¾ç½®ï¼ŒAlamofireä»iOS10.1æ‰å¼€å§‹æ”¯æŒåŠé”€è¯ä¹¦çš„ç­–ç•¥ã€‚</p>
</li>
<li><p><strong>PinnedCertificatesTrustEvaluator</strong>ï¼ˆè¯ä¹¦éªŒè¯ç­–ç•¥ï¼‰appç«¯ä¼šå¯¹æœåŠ¡å™¨ç«¯è¿”å›çš„è¯ä¹¦å’Œæœ¬åœ°ä¿å­˜çš„è¯ä¹¦ä¸­çš„å…¨éƒ¨å†…å®¹è¿›è¡Œæ ¡éªŒéœ€è¦å…¨éƒ¨æ­£ç¡®ï¼Œæ­¤éªŒè¯ç­–ç•¥è¿˜å¯ä»¥æ¥å—è‡ªç­¾åè¯ä¹¦ï¼Œå®‰å…¨æ€§ç›¸å¯¹è¾ƒé«˜ï¼Œæ­¤æ–¹æ³•è¾ƒä¸ºå›ºå®šï¼Œå¦‚æœ Server æ›´æ–°è¯ä¹¦ï¼ŒApp éœ€è¦å®šæœŸæ›´æ–°å¹¶é‡æ–°ä¸Šæ¶ã€‚</p>
</li>
<li><p><strong>PublicKeysTrustEvaluator</strong>ï¼ˆå…¬é’¥éªŒè¯ç­–ç•¥ï¼‰appç«¯åªä¼šå¯¹æœåŠ¡å™¨è¿”å›çš„è¯ä¹¦å’Œæœ¬åœ°ä¿å­˜çš„è¯ä¹¦ä¸­çš„ PublicKey(å…¬é’¥)è¿›è¡Œæ ¡éªŒï¼Œæ‰€ä»¥å½“è¯ä¹¦éœ€è¦æ›´æ–°æ—¶ï¼Œåªéœ€ç¡®ä¿å…¬é’¥ä¿æŒä¸å˜ï¼Œä¸éœ€è¦æ›´æ–°Appã€‚</p>
</li>
<li><p><strong>CompositeTrustEvaluator</strong>ï¼ˆè‡ªå®šä¹‰ç»„åˆéªŒè¯ç­–ç•¥ï¼‰ä»¥ä¸Šå¤šç§ç­–ç•¥ç»„åˆä¸€èµ·ï¼Œåªæœ‰åœ¨æ‰€æœ‰æ•°ç»„ä¸­å€¼éƒ½æˆåŠŸæ—¶æ‰æˆåŠŸã€‚</p>
</li>
<li><p><strong>DisabledTrustEvalutor</strong>ï¼ˆä¸éªŒéªŒè¯ç­–ç•¥ï¼‰æ— æ¡ä»¶ä¿¡ä»»ï¼Œæ‰€æœ‰éƒ½å¯ä»¥é€šè¿‡éªŒè¯ã€‚æ­£å¼ç¯å¢ƒä¸å»ºè®®ç”¨æ­¤ç­–ç•¥ï¼Œå¤šç”¨äºæµ‹è¯•ã€‚</p>
</li>
</ol>
</blockquote>
<p><strong>æˆ‘ä»¬ç”¨çš„æ˜¯PublicKeysTrustEvaluatorï¼ˆå…¬é’¥éªŒè¯ç­–ç•¥ï¼‰</strong></p>
<hr>
<blockquote>
<p>åå°æä¾›è¯ä¹¦ï¼Œå°†æ­£å¼æ”¾åœ¨é¡¹ç›®ç›®å½•ä¸­ã€‚</p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/d2b909e2935eccedbf88e97df824ecf9.png" alt="æœ¬åœ°è¯ä¹¦å­˜æ”¾"></p>
<blockquote>
<p>è·å–æœ¬åœ°è¯ä¹¦ï¼Œæå–è¯ä¹¦çš„å…¬é’¥ï¼ˆè·å–å…¬é’¥keyæ•°ç»„ï¼‰ã€‚è¯ä¹¦åç¼€åä¸€èˆ¬æœ‰ï¼š.cerã€.crtã€.derç­‰ï¼Œæˆ‘é¡¹ç›®ä¸­ç”¨çš„cerï¼Œè¯ä¹¦é“¾å¿…é¡»åŒ…å«ä¸€ä¸ªå›ºå®šçš„å…¬é’¥ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">struct WTCertificates &#123;</span><br><span class="line">    static let rootCA = WTCertificates.certificate( )</span><br><span class="line">    static func certificate() -&gt; [SecKey] &#123;</span><br><span class="line">        var publicKeyArray:[SecKey] = []</span><br><span class="line">        for resource in [&quot;xxx&quot;, &quot;xxxx&quot;, &quot;xxxxx&quot;] &#123;// æœ¬åœ°è¯ä¹¦åç§°</span><br><span class="line">            if let filePath = Bundle.main.path(forResource: resource, ofType: &quot;cer&quot;), let data = try? Data(contentsOf: URL(fileURLWithPath: filePath)) as CFData, let certificate = SecCertificateCreateWithData(nil, data),let publicKey = certificate.af.publicKey &#123;</span><br><span class="line">                publicKeyArray.append(publicKey)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return publicKeyArray</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç»™Sessionæ·»åŠ ç­–ç•¥ï¼ˆæ¥å—è´¨è¯¢ï¼‰</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var requestManagerSession: Session = &#123;</span><br><span class="line">    if WTCertificates.rootCA.count &gt; 0, verifyCert &#123;</span><br><span class="line">        let certificates: [SecKey] = WTCertificates.rootCA</span><br><span class="line">        let trustPolicy = PublicKeysTrustEvaluator(keys: certificates, performDefaultValidation: false, validateHost: false)</span><br><span class="line">        let manager = ServerTrustManager(evaluators: [</span><br><span class="line">            &quot;xxx.xxx.com&quot;: trustPolicy,</span><br><span class="line">            &quot;xx.xx.jftplus.com&quot;: trustPolicy,</span><br><span class="line">            &quot;xxx.xx.com&quot;: trustPolicy])// base url å¦‚ä½•åŸŸåè¿‡å¤šï¼Œå¯ä»¥å­ç±»åŒ– ServerTrustManagerï¼Œå¹¶ç”¨è‡ªå·±çš„è‡ªå®šä¹‰å®ç°é‡å†™ serverTrustEvaluator(forHost:) æ–¹æ³•</span><br><span class="line">        let configuration = URLSessionConfiguration.af.default</span><br><span class="line">        return Session(configuration: configuration, serverTrustManager: manager)</span><br><span class="line">    &#125;</span><br><span class="line">    return MoyaProvider&lt;ApiManager&gt;.defaultAlamofireSession()</span><br><span class="line">&#125;()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>åœ¨Moyaä¸­æ·»åŠ requestManagerSession</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var JKOtherApiManagerProvider = MoyaProvider&lt;JKOtherApiManager&gt;(endpointClosure: endpointMapping, requestClosure: requestTimeoutClosure, session:requestManagerSession, plugins:[RequestAlertPlugin(), networkPlugin])</span><br></pre></td></tr></table></figure>
<h2 id="OC-HTTPS-è¯ä¹¦é…ç½®éªŒè¯"><a href="#OC-HTTPS-è¯ä¹¦é…ç½®éªŒè¯" class="headerlink" title="OC HTTPS è¯ä¹¦é…ç½®éªŒè¯"></a>OC HTTPS è¯ä¹¦é…ç½®éªŒè¯</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//1 å°†è¯ä¹¦æ‹–è¿›é¡¹ç›®</span><br><span class="line"></span><br><span class="line">//2 è·å–è¯ä¹¦è·¯å¾„</span><br><span class="line">NSString *certPath = [[NSBundle mainBundle] pathForResource: @&quot;cetus&quot; ofType:@&quot;cer&quot;];</span><br><span class="line">//3 è·å–è¯ä¹¦data</span><br><span class="line">NSData *certData = [NSData dataWithContentsOfFile:certPath];</span><br><span class="line">//4 åˆ›å»ºAFN ä¸­çš„securityPolicy</span><br><span class="line">AFSecurityPolicy *securityPolicy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModePublicKey withPinnedCertificates:[[NSSet alloc] initWithObjects:certData,nil]];</span><br><span class="line">//5 è¿™é‡Œå°±å¯ä»¥æ·»åŠ å¤šä¸ªserverè¯ä¹¦</span><br><span class="line">NSSet *dataSet = [[NSSet alloc]initWithObjects:certData, nil];</span><br><span class="line">//6 ç»‘å®šè¯ä¹¦ï¼ˆä¸æ­¢ä¸€ä¸ªè¯ä¹¦ï¼‰</span><br><span class="line">[securityPolicy setPinnedCertificates:dataSet];</span><br><span class="line">//7 æ˜¯å¦å…è®¸æ— æ•ˆè¯ä¹¦</span><br><span class="line">securityPolicy.allowInvalidCertificates = YES;</span><br><span class="line">//8 æ˜¯å¦éœ€è¦éªŒè¯åŸŸå</span><br><span class="line">securityPolicy.validatesDomainName = YES;</span><br><span class="line">uploadManager.securityPolicy = securityPolicy;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬åå°ç»™çš„è¯ä¹¦æ ¼å¼åç¼€æ˜¯.pemï¼Œä»¥ä¸‹æ˜¯ç”¨OpenSSLå‘½ä»¤å°†.pemè¯ä¹¦è½¬æ¢ä¸ºceræ ¼å¼è¯ä¹¦æ–¹æ³•</p>
</blockquote>
<ol>
<li>æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿›å…¥å­˜æ”¾xxx.pemè¯ä¹¦çš„ç›®å½•</li>
<li>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå°†.pemè¯ä¹¦è½¬æ¢ä¸ºceræ ¼å¼<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -in xxx.pem -inform PEM -out xxx.cer -outform DER</span><br></pre></td></tr></table></figure></li>
<li>æ‰§è¡Œå®Œæ¯•åï¼Œæ‚¨å°†åœ¨å½“å‰ç›®å½•ä¸‹çœ‹åˆ°ç”Ÿæˆçš„xxx.ceræ–‡ä»¶</li>
</ol>
<blockquote>
<p><strong>æ³¨æ„ï¼šè½¬æ¢åçš„cerè¯ä¹¦æ–‡ä»¶åªåŒ…å«å…¬é’¥ï¼Œä¸åŒ…å«ç§é’¥ä¿¡æ¯</strong></p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CSSL%E2%80%9D/" rel="tag">â€œSSLâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9Cswift%E2%80%9D/" rel="tag">â€œswiftâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9C%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81%E2%80%9D/" rel="tag">â€œè¯ä¹¦éªŒè¯â€</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="[layout]-é¡¹ç›®å‰–æ03-swift-ç½‘ç»œè¯·æ±‚Moya-HandyJSON-RxSwift"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/23/%E9%A1%B9%E7%9B%AE%E5%89%96%E6%9E%9003-swift-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82Moya-HandyJSON-RxSwift/"
    >é¡¹ç›®å‰–æ03-swift ç½‘ç»œè¯·æ±‚Moya+HandyJSON+RxSwift</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/12/23/%E9%A1%B9%E7%9B%AE%E5%89%96%E6%9E%9003-swift-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82Moya-HandyJSON-RxSwift/" class="article-date">
  <time datetime="2019-12-23T08:39:52.000Z" itemprop="datePublished">2019-12-23</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/swift/">swift</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>é¡¹ç›®ç¬¬ä¸€ç‰ˆç½‘ç»œæ¡†æ¶ç”¨çš„æ˜¯<a target="_blank" rel="noopener" href="https://github.com/bustoutsolutions/siesta">siesta</a>,å®ƒçš„ç¼“å­˜ä¸è‡ªåŠ¨åˆ·æ–°ç¡®å®å¾ˆå¥½ç”¨è€Œä¸”ä»£ç å¾ˆç®€æ´ï¼Œä½†æ˜¯åœ¨æ–‡ä»¶çš„ä¸Šä¼ ä¸ä¸‹è½½ä»¥åŠå¯¹è¿”å›ç±»å‹éœ€è¦ç²¾ç¡®åŒ¹é…è¦æ±‚è¿™æ–¹é¢å°±å¾ˆä¸å‹å¥½ï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒç‰ˆçš„æˆ‘é€‰æ‹©äº†<a target="_blank" rel="noopener" href="https://github.com/Moya/Moya">Moya</a>,å®ƒæ˜¯ä¸€ä¸ªç½‘ç»œæŠ½è±¡å±‚ï¼Œå®ƒåœ¨<a target="_blank" rel="noopener" href="https://github.com/Alamofire/Alamofire">Alamofire</a>åŸºç¡€ä¸Šæä¾›äº†ä¸€ç³»åˆ—çš„æŠ½è±¡æ¥å£æ–¹ä¾¿ç»´æŠ¤ã€‚å…³äº<code>Moya</code>çš„ä½¿ç”¨ä»‹ç»å¾ˆå¤šï¼Œæˆ‘å°±ä¸å†èµ˜è¿°äº†ã€‚æˆ‘ä¸»è¦è®°å½•ä¸€ä¸‹æˆ‘åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å­¦åˆ°çš„å¤„ç†æ–¹å¼ã€‚æˆ‘çš„ç½‘ç»œæ¡†æ¶æ˜¯æ­ç€<a target="_blank" rel="noopener" href="https://github.com/alibaba/HandyJSON">HandyJSON</a>å’Œ<a target="_blank" rel="noopener" href="https://github.com/Moya/Moya/blob/master/docs/RxSwift.md">RxSwift</a>ä¸€èµ·æ„å»ºçš„ã€‚</p>
</blockquote>
<h3 id="Moya"><a href="#Moya" class="headerlink" title="Moya"></a>Moya</h3><p><strong>ä»£ç </strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">import enum Result.Result</span><br><span class="line">import Alamofire</span><br><span class="line"></span><br><span class="line">//è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´</span><br><span class="line">private let requestTimeoutClosure = &#123; (endpoint: Endpoint, done: @escaping MoyaProvider&lt;ApiManager&gt;.RequestResultClosure) in</span><br><span class="line">    do &#123;</span><br><span class="line">        var request = try endpoint.urlRequest()</span><br><span class="line">        request.timeoutInterval = 60</span><br><span class="line">        done(.success(request))</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let ApiManagerProvider = MoyaProvider&lt;ApiManager&gt;(endpointClosure: endpointMapping, requestClosure: requestTimeoutClosure, plugins:[])</span><br><span class="line"></span><br><span class="line">// MARK: å–æ¶ˆæ‰€æœ‰è¯·æ±‚</span><br><span class="line">func cancelAllRequest() &#123;</span><br><span class="line">    WTOtherProvider.manager.session.getTasksWithCompletionHandler &#123; dataTasks, uploadTasks, downloadTasks in</span><br><span class="line">        dataTasks.forEach &#123; $0.cancel() &#125;</span><br><span class="line">        uploadTasks.forEach &#123; $0.cancel() &#125;</span><br><span class="line">        downloadTasks.forEach &#123; $0.cancel() &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    WTLoginProvider.manager.session.getTasksWithCompletionHandler &#123; dataTasks, uploadTasks, downloadTasks in</span><br><span class="line">        dataTasks.forEach &#123; $0.cancel() &#125;</span><br><span class="line">        uploadTasks.forEach &#123; $0.cancel() &#125;</span><br><span class="line">        downloadTasks.forEach &#123; $0.cancel() &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    â€¦â€¦</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">public func endpointMapping&lt;Target: TargetType&gt;(target: Target) -&gt; Endpoint &#123;</span><br><span class="line">    WTDLog(&quot;è¯·æ±‚è¿æ¥ï¼š\(target.baseURL)\(target.path) \næ–¹æ³•ï¼š\(target.method)\nå‚æ•°ï¼š\(String(describing: target.task.self)) &quot;)</span><br><span class="line">    return MoyaProvider.defaultEndpointMapping(for: target)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">final class RequestAlertPlugin: PluginType &#123;</span><br><span class="line">    </span><br><span class="line">    func prepare(_ request: URLRequest, target: TargetType) -&gt; URLRequest &#123;</span><br><span class="line">        return request</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func willSend(_ request: RequestType, target: TargetType) &#123;</span><br><span class="line">        //å®ç°å‘é€è¯·æ±‚å‰éœ€è¦åšçš„äº‹æƒ…</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public func didReceive(_ result: Result&lt;Response, MoyaError&gt;, target: TargetType) &#123;</span><br><span class="line"></span><br><span class="line">        switch result &#123;</span><br><span class="line">        case .success(let response):</span><br><span class="line">            guard response.statusCode == 200 else &#123;</span><br><span class="line">                if response.statusCode == 401 &#123;</span><br><span class="line">                    if isJumpLogin == false &#123;</span><br><span class="line">                        cancelAllRequest()</span><br><span class="line">                        // é€€å‡ºç™»å½•</span><br><span class="line">                        if let nvc = (WTNavigationManger.Nav as? WTMainViewController) &#123;</span><br><span class="line">                            nvc.login()</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return</span><br><span class="line">            &#125;</span><br><span class="line">            var json = try? JSON(data: response.data)</span><br><span class="line">            WTDLog(&quot;è¯·æ±‚çŠ¶æ€ç \(json?[&quot;status&quot;] ?? &quot;&quot;)&quot;)</span><br><span class="line">            </span><br><span class="line">            guard let codeString = json?[&quot;status&quot;] else &#123;return&#125;</span><br><span class="line">             if codeString == 401 &#123;// é€€å‡ºç™»å½•</span><br><span class="line">                if isJumpLogin == false &#123;</span><br><span class="line">                    cancelAllRequest()</span><br><span class="line">                    if let nvc = (WTNavigationManger.Nav as? WTMainViewController) &#123;</span><br><span class="line">                        nvc.login()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                break</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        case .failure(let error):</span><br><span class="line">            WTDLog(error)</span><br><span class="line">            let myAppdelegate = UIApplication.shared.delegate as! AppDelegate</span><br><span class="line">            myAppdelegate.listenNetwork()</span><br><span class="line">            break</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct AuthPlugin: PluginType &#123;</span><br><span class="line">    let token: String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enum ApiManager &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension ApiManager: TargetType &#123;</span><br><span class="line">    var headers: [String : String]? &#123;</span><br><span class="line">        var dict = [&quot;ColaLanguage&quot;: (&quot;common.isChinese&quot;.L() == &quot;YES&quot;) ? &quot;CN&quot; : &quot;EN&quot;]</span><br><span class="line">        if let authToken =  WTLoginInfoManger.shareDataSingle.model?.accessToken &#123;</span><br><span class="line">            dict[&quot;Authorization&quot;] = authToken</span><br><span class="line">        &#125;</span><br><span class="line">        return dict</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var baseURL: URL &#123;</span><br><span class="line">        return URL.init(string: AppURLHOST.MyPublicBaseURL)!</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var path: String &#123;</span><br><span class="line">        return &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var method: Moya.Method &#123;</span><br><span class="line">        return .get</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var task: Task &#123;</span><br><span class="line">        return .requestPlain</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var validate: Bool &#123;</span><br><span class="line">        return false</span><br><span class="line">    &#125;</span><br><span class="line">    var sampleData: Data &#123;</span><br><span class="line">        return &quot;&quot;.data(using: String.Encoding.utf8)!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/// æ•°æ® è½¬ æ¨¡å‹</span><br><span class="line">extension ObservableType where E == Response &#123;</span><br><span class="line">    public func mapHandyJsonModel&lt;T: HandyJSON&gt;(_ type: T.Type) -&gt; Observable&lt;T&gt; &#123;</span><br><span class="line">        return flatMap &#123; response -&gt; Observable&lt;T&gt; in</span><br><span class="line">            return Observable.just(response.mapHandyJsonModel(T.self))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/// æ•°æ® è½¬ æ¨¡å‹</span><br><span class="line">extension Response &#123;</span><br><span class="line">    func mapHandyJsonModel&lt;T: HandyJSON&gt;(_ type: T.Type) -&gt; T &#123;</span><br><span class="line">        let jsonString = String.init(data: data, encoding: .utf8)</span><br><span class="line">        if let modelT = JSONDeserializer&lt;T&gt;.deserializeFrom(json: jsonString) &#123;</span><br><span class="line">            return modelT</span><br><span class="line">        &#125;</span><br><span class="line">        return JSONDeserializer&lt;T&gt;.deserializeFrom(json: &quot;&#123;\&quot;msg\&quot;:\&quot;\(&quot;common.try&quot;.L())\&quot;&#125;&quot;)!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/// è‡ªå®šä¹‰æ’ä»¶</span><br><span class="line">public final class NetworkLoadingPlugin: PluginType &#123;</span><br><span class="line">    public func willSend(_ request: RequestType, target: TargetType) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    public func didReceive(_ result: Result&lt;Moya.Response, MoyaError&gt;, target: TargetType) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ¨¡å¼Target -&gt; Endpoint -&gt; Request</strong></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/24422c24f3f5cf628f45d967e4ec09c9.png" alt="æ¥è‡ªGitHubå›¾ç‰‡"></p>
<blockquote>
<p><code>Moya</code>è™½ç„¶æ˜¯åŸºäºAlamofireçš„ä½†æ˜¯æˆ‘ä»¬åœ¨ä»£ç ä¸­å´ä¸ä¼šå’ŒAlamofireæ‰“äº¤é“ï¼Œå®ƒæ˜¯é€šè¿‡æšä¸¾æ¥ç®¡ç†APIçš„ã€‚æˆ‘åœ¨é¡¹ç›®ä¸­å®šä¹‰æ¥ä¸€ä¸ªAPIåŸºç±»ï¼Œç„¶åä¸ºæ¯ä¸€ä¸ªæ¨¡å—å®šä¹‰äº†ä¸€ä¸ªAPIç®¡ç†ç±»ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum HomeApiManager &#123;</span><br><span class="line">    case getBanner // è·å–è½®æ’­</span><br><span class="line">    case getAnnouncement(per_page: String) // è·å–å…¬å‘Š</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¯¹äºè¯·æ±‚ç±»å‹çš„æ”¹å˜å’Œå¯¹äºURLçš„æ”¹å˜ä¹Ÿæ˜¯é€šè¿‡æšä¸¾</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var method: Moya.Method &#123;</span><br><span class="line">        switch self &#123;</span><br><span class="line">        case .orderCreate:</span><br><span class="line">            return .post</span><br><span class="line">        case .orderCancelById, .orderCancelByPair:</span><br><span class="line">            return .delete</span><br><span class="line">        default:</span><br><span class="line">            return .get</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">var path: String &#123;</span><br><span class="line">        switch self &#123;</span><br><span class="line">        case .getKline:</span><br><span class="line">            return &quot;/api/kline&quot;</span><br><span class="line">        case .transGetByID(let orderId):</span><br><span class="line">            return &quot;/api/\(orderId)&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¯·æ±‚ä»»åŠ¡</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">var task: Task &#123;</span><br><span class="line">    switch self &#123;</span><br><span class="line">    case .securityPostGoogleAuth(let tokenKey, let oldGoogleCode, let googleCode, let captcha):</span><br><span class="line">        return .requestParameters(parameters: [&quot;captcha&quot;: captcha], encoding: JSONEncoding.default) // postè¯·æ±‚</span><br><span class="line"></span><br><span class="line">    case .getReward(let type, let cursor, let limit):</span><br><span class="line">        return .requestParameters(parameters: [&quot;type&quot;: type], encoding: URLEncoding.default) // å…¶å®ƒè¯·æ±‚</span><br><span class="line"></span><br><span class="line">    case .uploadImage(let imageArry):</span><br><span class="line">        let formDataAry:NSMutableArray = NSMutableArray()</span><br><span class="line">        for (index,image) in imageArry.enumerated() &#123;</span><br><span class="line">            //å›¾ç‰‡è½¬æˆData</span><br><span class="line">            let data:Data = image.jpegData(compressionQuality: 0.7)!</span><br><span class="line">            //æ ¹æ®å½“å‰æ—¶é—´è®¾ç½®å›¾ç‰‡ä¸Šä¼ æ—¶å€™çš„åå­—</span><br><span class="line">            var dateStr: String = &quot;yyyy-MM-dd-HH:mm:ss&quot;.timeStampToString(timeStamp: Date().timeIntervalSince1970)</span><br><span class="line">            //åˆ«å¿˜è®°è¿™é‡Œç»™åå­—åŠ ä¸Šå›¾ç‰‡çš„åç¼€å“¦</span><br><span class="line">            dateStr = dateStr.appendingFormat(&quot;-%i.jpg&quot;, index)</span><br><span class="line">            let formData = MultipartFormData(provider: .data(data), name: &quot;file\(index)&quot;, fileName: dateStr, mimeType: &quot;image/jpeg&quot;)</span><br><span class="line">            formDataAry.add(formData)</span><br><span class="line">        &#125;</span><br><span class="line">        return .uploadCompositeMultipart(formDataAry as! [MultipartFormData], urlParameters: [</span><br><span class="line">            :])</span><br><span class="line">        </span><br><span class="line">    default:</span><br><span class="line">        return .requestPlain</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ’ä»¶æœºåˆ¶"><a href="#æ’ä»¶æœºåˆ¶" class="headerlink" title="æ’ä»¶æœºåˆ¶"></a>æ’ä»¶æœºåˆ¶</h3><blockquote>
<p><code>Moya</code>çš„å¦ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½å°±æ˜¯å®ƒçš„æ’ä»¶æœºåˆ¶ï¼Œæä¾›äº†ä¸¤ä¸ªæ¥å£ï¼ŒwillSendRequest å’Œ didReceiveResponseï¼Œå®ƒå¯ä»¥åœ¨è¯·æ±‚å‰å’Œè¯·æ±‚ååšä¸€äº›é¢å¤–çš„æ“ä½œè€Œå’Œä¸»åŠŸèƒ½æ˜¯è§£è€¦çš„ï¼Œæ¯”å¦‚å¯ä»¥åœ¨è¯·æ±‚å‰å¼€å§‹åŠ è½½åŠ¨ç”»è¯·æ±‚ç»“æŸåç§»é™¤åŠ è½½åŠ¨ç”»ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰æ’ä»¶ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">final class RequestAlertPlugin: PluginType &#123;</span><br><span class="line">    func prepare(_ request: URLRequest, target: TargetType) -&gt; URLRequest &#123;</span><br><span class="line">        return request</span><br><span class="line">    &#125;</span><br><span class="line">    func willSend(_ request: RequestType, target: TargetType) &#123;</span><br><span class="line">        ç°å‘é€è¯·æ±‚å‰éœ€è¦åšçš„äº‹æƒ…</span><br><span class="line">        if target.headers?[&quot;isHiddentLoading&quot;] != &quot;true&quot; &#123;</span><br><span class="line">            currentView?.addSubview(activityIndicatorView)</span><br><span class="line">            activityIndicatorView.center = currentView!.center</span><br><span class="line">            activityIndicatorView.startAnimating()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public func didReceive(_ result: Result&lt;Response, MoyaError&gt;, target: TargetType) &#123;</span><br><span class="line">        if activityIndicatorView.isAnimating &#123;</span><br><span class="line">            activityIndicatorView.stopAnimating()</span><br><span class="line">            activityIndicatorView.removeFromSuperview()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/// è‡ªå®šä¹‰æ’ä»¶</span><br><span class="line">public final class NetworkLoadingPlugin: PluginType &#123;</span><br><span class="line">    public func willSend(_ request: RequestType, target: TargetType) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    public func didReceive(_ result: Result&lt;Moya.Response, MoyaError&gt;, target: TargetType) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Moyaé»˜è®¤æœ‰4ä¸ªæ’ä»¶</p>
<ol>
<li><p>AccessTokenPlugin    &#x2F;&#x2F; ç®¡ç†AccessTokençš„æ’ä»¶</p>
</li>
<li><p>CredentialsPlugin       &#x2F;&#x2F; ç®¡ç†è®¤è¯çš„æ’ä»¶</p>
</li>
<li><p>NetworkActivityPlugin &#x2F;&#x2F; ç®¡ç†ç½‘ç»œçŠ¶æ€çš„æ’ä»¶</p>
</li>
<li><p>NetworkLoggerPlugin &#x2F;&#x2F; ç®¡ç†ç½‘ç»œlogçš„æ’ä»¶</p>
</li>
</ol>
</blockquote>
<h3 id="RxSwift"><a href="#RxSwift" class="headerlink" title="RxSwift"></a>RxSwift</h3><blockquote>
<p>è¿™é‡Œçš„RxSwiftä¸æ˜¯å®Œæ•´çš„RxSwiftï¼Œè€Œæ˜¯ä¸ºMoyaå®šåˆ¶çš„ä¸€ä¸ªæ‰©å±•(pod â€˜Moya&#x2F;RxSwiftâ€™)åœ¨æ•°æ®è¯·æ±‚å›æ¥åè¿›è¡Œå¤„ç†ã€‚</p>
<ol>
<li><p>request()  ä¼ å…¥API</p>
</li>
<li><p>asObservable() æ˜¯Moyaä¸ºRxSwiftæä¾›çš„æ‰©å±•æ–¹æ³•ï¼Œè¿”å›å¯ç›‘å¬åºåˆ—</p>
</li>
<li><p>mapHandyJsonModel() ä¹Ÿæ˜¯Moya RxSwiftçš„æ‰©å±•æ–¹æ³•è¿›è¡Œè‡ªå®šä¹‰çš„ï¼Œå¯ä»¥æŠŠè¿”å›çš„æ•°æ®è§£ææˆmodel</p>
</li>
<li><p>subscribe() æ˜¯å¯¹å¤„ç†è¿‡çš„ Observable è®¢é˜…ä¸€ä¸ª onNext çš„è§‚å¯Ÿè€…ï¼Œä¸€æ—¦å¾—åˆ°JSONæ ¼å¼çš„æ•°æ®ï¼Œå°±ä¼šç»è¡Œç›¸åº”çš„å¤„ç†</p>
</li>
<li><p>disposed() æ˜¯RxSwiftçš„ä¸€ä¸ªè‡ªåŠ¨å†…å­˜å¤„ç†æœºåˆ¶ï¼Œç±»ä¼¼ARCï¼Œä¼šè‡ªåŠ¨å¤„ç†ä¸éœ€è¦çš„å¯¹è±¡</p>
</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">/// æ•°æ® è½¬ æ¨¡å‹</span><br><span class="line">extension ObservableType where E == Response &#123;</span><br><span class="line">    public func mapHandyJsonModel&lt;T: HandyJSON&gt;(_ type: T.Type) -&gt; Observable&lt;T&gt; &#123;</span><br><span class="line">        return flatMap &#123; response -&gt; Observable&lt;T&gt; in</span><br><span class="line">            return Observable.just(response.mapHandyJsonModel(T.self))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/// æ•°æ® è½¬ æ¨¡å‹</span><br><span class="line">extension Response &#123;</span><br><span class="line">    func mapHandyJsonModel&lt;T: HandyJSON&gt;(_ type: T.Type) -&gt; T &#123;</span><br><span class="line">        let jsonString = String.init(data: data, encoding: .utf8)</span><br><span class="line">        if let modelT = JSONDeserializer&lt;T&gt;.deserializeFrom(json: jsonString) &#123;</span><br><span class="line">            return modelT</span><br><span class="line">        &#125;</span><br><span class="line">        return JSONDeserializer&lt;T&gt;.deserializeFrom(json: &quot;&#123;\&quot;msg\&quot;:\&quot;\(&quot;common.try&quot;.L())\&quot;&#125;&quot;)!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">extension WTApiManager &#123;</span><br><span class="line">    class func NetExchangeRequest&lt;T: BaseModel&gt;(disposeBag: DisposeBag,type: ExchangeApiManager, model: T.Type, isBackFail: Bool = false, Success:@escaping (T)-&gt;(), Error: @escaping ()-&gt;()) &#123;</span><br><span class="line">        WTExchangeProvider.rx.request(type)</span><br><span class="line">            .asObservable()</span><br><span class="line">            .mapHandyJsonModel(model)</span><br><span class="line">            .subscribe &#123; (event) in</span><br><span class="line">                switch event &#123;</span><br><span class="line">                case let .next(data):</span><br><span class="line">                    if isBackFail &#123;</span><br><span class="line">                        Success(data)</span><br><span class="line">                        break</span><br><span class="line">                    &#125;</span><br><span class="line">                    guard data.status == 200 else &#123;</span><br><span class="line">                        WTProgressHUD.show(error: data.message ?? &quot;common.try&quot;.L(), toView: nil)</span><br><span class="line">                        Error()</span><br><span class="line">                        break</span><br><span class="line">                    &#125;</span><br><span class="line">                    Success(data)</span><br><span class="line">                    break</span><br><span class="line">                case let .error(error):</span><br><span class="line">                    WTDLog(error)</span><br><span class="line">                    Error()</span><br><span class="line">                    break</span><br><span class="line">                default:</span><br><span class="line">                    break</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HandyJSON"><a href="#HandyJSON" class="headerlink" title="HandyJSON"></a>HandyJSON</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class BaseModel: HandyJSON &#123;</span><br><span class="line">    var status: Int = 0</span><br><span class="line">    var message: String? = nil // æœåŠ¡ç«¯è¿”å›æç¤º</span><br><span class="line">    required init()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class WTBaseModel&lt;T: HandyJSON&gt;: BaseModel &#123;</span><br><span class="line">    var data: T? // å…·ä½“çš„dataçš„æ ¼å¼å’Œä¸šåŠ¡ç›¸å…³ï¼Œæ•…ç”¨æ³›å‹å®šä¹‰</span><br><span class="line">&#125;</span><br><span class="line">struct WTCurrencyBalanceModel: HandyJSON &#123;</span><br><span class="line">    var coinCode: String = &quot;&quot;</span><br><span class="line">    let balanceAvailable: Double = 0.0</span><br><span class="line">    let balanceFrozen: Double = 0.0</span><br><span class="line">    let worth: Double = 0.0</span><br><span class="line">&#125;</span><br><span class="line">// ç½‘ç»œè¯·æ±‚ ä¼ å…¥å¯¹åº”model</span><br><span class="line">WTApiManager.NetOtherRequest(disposeBag: disposeBag, type: .getMarketsPrice, model: WTBaseModel&lt;WTRateModel&gt;, Success: &#123;(model) in</span><br><span class="line">&#125;) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨"><a href="#ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨" class="headerlink" title="ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨"></a>ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨</h3><p><strong><code>Moya+HandyJSON+RxSwift</code>çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰é”™è¯¯æˆ–è€…ä¸è¶³ä¹‹å¤„è¿˜æœ›æŒ‡æ­£ï¼Œè°¢è°¢</strong></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CHandyJSON%E2%80%9D/" rel="tag">â€œHandyJSONâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CMoya%E2%80%9D/" rel="tag">â€œMoyaâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CRxSwift%E2%80%9D/" rel="tag">â€œRxSwiftâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9Cswift%E2%80%9D/" rel="tag">â€œswiftâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9C%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E2%80%9D/" rel="tag">â€œç½‘ç»œè¯·æ±‚â€</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="[layout]-é¡¹ç›®å‰–æ02-swift-è½»æ¾å®ç°åŠ¨ç”»æ•ˆæœ-Lottie"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/23/%E9%A1%B9%E7%9B%AE%E5%89%96%E6%9E%9002-swift-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C-Lottie/"
    >é¡¹ç›®å‰–æ02-swift è½»æ¾å®ç°åŠ¨ç”»æ•ˆæœ-Lottie</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/12/23/%E9%A1%B9%E7%9B%AE%E5%89%96%E6%9E%9002-swift-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C-Lottie/" class="article-date">
  <time datetime="2019-12-23T04:34:37.000Z" itemprop="datePublished">2019-12-23</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/iOS/">iOS</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/airbnb/lottie-ios">Lottie</a> æ˜¯ <a target="_blank" rel="noopener" href="https://lottiefiles.com/?lang=zh_CN">Airbnb</a>å¼€æºçš„ä¸€å¥—è·¨å¹³å°çš„åŠ¨ç”»æ•ˆæœè§£å†³æ–¹æ¡ˆ,å®ƒèƒ½å¤ŸåŒæ—¶æ”¯æŒ<code>iOS</code>ã€<code>Android</code>ã€<code>Web</code> å’Œ <code>React Native</code>çš„å¼€å‘ï¼Œè®¾è®¡å¸ˆåªéœ€è¦ç”¨ <a target="_blank" rel="noopener" href="https://www.adobe.com/cn/products/aftereffects.html">AdobeAfterEffects</a>(AE) è®¾è®¡å‡ºéœ€è¦çš„çš„åŠ¨ç”»ä¹‹åï¼Œä½¿ç”¨ <code>Lottie</code> æä¾›çš„ <a target="_blank" rel="noopener" href="https://github.com/bodymovin/bodymovin">Bodymovin</a> æ’ä»¶å°†è®¾è®¡å¥½çš„åŠ¨ç”»å¯¼å‡ºæˆJSONæ ¼å¼(æ–‡ä»¶å¾ˆå°ä¸ä¼šè±¡GIFé‚£ä¹ˆåºå¤§)ç»™ä½ å³å¯ï¼Œå¯ä»¥è®©è®¾è®¡å¸ˆå®ç°æ‰€è§å³æ‰€å¾—çš„åŠ¨ç”»å†ä¹Ÿä¸ç”¨å’Œè®¾è®¡å¸ˆäº‰è®ºåŠ¨ç”»è®¾è®¡äº†ã€‚æœ¬æ–‡åªæ˜¯å±•ç¤ºåœ¨swiftä¸­å¦‚ä½•ç®€å•ä½¿ç”¨<code>Lottie</code> ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ<a target="_blank" rel="noopener" href="https://airbnb.io/lottie/#/">å®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/9435d33b4f8d95e2fbaed37fa0c418ba.gif" alt="githubä¾‹å›¾"></p>
<h3 id="ç”¨æ³•ä¸¾ä¾‹"><a href="#ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="ç”¨æ³•ä¸¾ä¾‹"></a>ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">lazy var lottieAnimationView: AnimationView = &#123;</span><br><span class="line">        // åŠ è½½æœ¬åœ°èµ„æº</span><br><span class="line">        let path : String = Bundle.main.path(forResource: &quot;data&quot;, ofType: &quot;json&quot;)!</span><br><span class="line">        let lottieAnimationView = AnimationView.init(filePath: path)</span><br><span class="line">        WTNavigationManger.Nav?.view.addSubview(lottieAnimationView)</span><br><span class="line">        lottieAnimationView.constrain(toSuperviewEdges: nil)</span><br><span class="line">        lottieAnimationView.isUserInteractionEnabled = true</span><br><span class="line">        lottieAnimationView.addGestureRecognizer(UITapGestureRecognizer(target: self, action: #selector(removeLottieAnimationViewFromParent)))</span><br><span class="line">        return lottieAnimationView</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨</span><br><span class="line">lottieAnimationView.play &#123;[weak self] (complete) in</span><br><span class="line">       guard let mySelf = self else &#123;return&#125;</span><br><span class="line">       mySelf.removeLottieAnimationViewFromParent()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">@objc func removeLottieAnimationViewFromParent() &#123;</span><br><span class="line">        lottieAnimationView.removeFromSuperview()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°†è®¾è®¡å¸ˆç»™ä½ çš„æ–‡ä»¶å¯¼å…¥é¡¹ç›®ï¼Œç„¶åé€šè¿‡Bundle.main.path(forResource:æ‰¾åˆ°jsonæ–‡ä»¶ï¼Œç„¶åå°†AnimationViewæ·»åŠ åˆ°è§†å›¾ï¼Œåœ¨éœ€è¦å±•ç¤ºåŠ¨ç”»çš„åœ°æ–¹è°ƒç”¨play() æ–¹æ³•ï¼Œè¿™æ ·åŠ¨ç”»å°±å¯ä»¥åŠ è½½äº†ã€‚</p>
</blockquote>
<h3 id="å¼•å…¥jsonçš„æ–¹å¼"><a href="#å¼•å…¥jsonçš„æ–¹å¼" class="headerlink" title="å¼•å…¥jsonçš„æ–¹å¼"></a>å¼•å…¥jsonçš„æ–¹å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/// jsonæ‰€åœ¨çš„æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºBundle.main</span><br><span class="line">let animation = Animation.named(&quot;StarAnimation&quot;) </span><br><span class="line">/// é»˜è®¤ä¸ºBundle.main</span><br><span class="line">let animation = Animation.named(&quot;StarAnimation&quot;, bundle: myBundle)</span><br><span class="line">/// subdirectory ä¸ºåŠ¨ç”»æ‰€åœ¨çš„åŒ…ä¸­çš„å­ç›®å½•(å¯é€‰çš„)</span><br><span class="line">let animation = Animation.named(&quot;StarAnimation&quot;, subdirectory: &quot;Animations&quot;)</span><br><span class="line">/// animationCache ä¸ºä¿å­˜åŠ è½½åŠ¨ç”»çš„ç¼“å­˜(å¯é€‰çš„)</span><br><span class="line">let animation = Animation.named(&quot;StarAnimation&quot;, animationCache: LRUAnimationCache.sharedCache)</span><br></pre></td></tr></table></figure>

<h3 id="æŒ‡å®šåŠ è½½è·¯å¾„"><a href="#æŒ‡å®šåŠ è½½è·¯å¾„" class="headerlink" title="æŒ‡å®šåŠ è½½è·¯å¾„"></a>æŒ‡å®šåŠ è½½è·¯å¾„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Animation.filepath(_ filepath: String, animationCache: AnimationCacheProvider?) -&gt; Animation?</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä»ç»å¯¹æ–‡ä»¶è·¯å¾„åŠ è½½åŠ¨ç”»æ¨¡å‹ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŠ¨ç”»ï¼Œåˆ™è¿”å›nil<br>filepath:è¦åŠ è½½çš„åŠ¨ç”»çš„ç»å¯¹æ–‡ä»¶è·¯å¾„<br>animationCache:ç”¨äºä¿å­˜åŠ è½½çš„åŠ¨ç”»çš„ç¼“å­˜(å¯é€‰çš„)</p>
</blockquote>
<h3 id="æ’­æ”¾åŠ¨ç”»"><a href="#æ’­æ”¾åŠ¨ç”»" class="headerlink" title="æ’­æ”¾åŠ¨ç”»"></a>æ’­æ”¾åŠ¨ç”»</h3><p><strong>åŸºæœ¬æ’­æ”¾(Basic Playing)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// æ’­æ”¾åŠ¨ç”»ä»å®ƒçš„å½“å‰çŠ¶æ€åˆ°å®ƒçš„æ—¶é—´è½´ç»“æŸã€‚åœ¨åŠ¨ç”»åœæ­¢æ—¶è°ƒç”¨completionä»£ç å—</span><br><span class="line">// å¦‚æœåŠ¨ç”»å®Œæˆï¼Œåˆ™completionè¿”å›trueã€‚å¦‚æœåŠ¨ç”»è¢«ä¸­æ–­ï¼Œåˆ™è¿”å›false</span><br><span class="line">AnimationView.play(completion: LottieCompletionBlock?)</span><br></pre></td></tr></table></figure>
<p><strong>åˆ©ç”¨è¿›åº¦æ—¶é—´(Play with Progress Time)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// æŒ‡å®šä¸€ä¸ªæ—¶é—´åˆ°å¦ä¸€ä¸ªæ—¶é—´çš„æ’­æ”¾</span><br><span class="line">AnimationView.play(fromProgress: AnimationProgressTime?, toProgress: AnimationProgressTime, loopMode: LottieLoopMode?, completion: LottieCompletionBlock?)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>æ—¶é—´å¸§æ’­æ”¾(Play with Marker Names)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// åŠ¨ç”»æ’­æ”¾ä»ä¸€ä¸ªæ—¶é—´å¸§åˆ°å¦ä¸€ä¸ªæ—¶é—´å¸§</span><br><span class="line">AnimationView.play(fromFrame: AnimationProgressTime?, toFrame: AnimationFrameTime, loopMode: LottieLoopMode?, completion: LottieCompletionBlock?)</span><br></pre></td></tr></table></figure>
<p><strong>æ—¶é—´å¸§æ’­æ”¾(Play with Marker Names)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// å°†åŠ¨ç”»ä»å‘½åæ ‡è®°æ’­æ”¾åˆ°å¦ä¸€ä¸ªæ ‡è®°ã€‚æ ‡è®°æ˜¯ç¼–ç åˆ°åŠ¨ç”»æ•°æ®ä¸­å¹¶æŒ‡å®šåç§°çš„æ—¶é—´ç‚¹</span><br><span class="line">AnimationView.play(fromMarker: String?, toMarker: String, loopMode: LottieLoopMode?, completion: LottieCompletionBlock?)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="å…¶å®ƒæ“ä½œ"><a href="#å…¶å®ƒæ“ä½œ" class="headerlink" title="å…¶å®ƒæ“ä½œ"></a>å…¶å®ƒæ“ä½œ</h3><blockquote>
<ol>
<li><p>AnimationView.pause() &#x2F;&#x2F; æš‚åœ</p>
</li>
<li><p>AnimationView.stop()  &#x2F;&#x2F; åœæ­¢</p>
</li>
<li><p>var AnimationView.backgroundBehavior: LottieBackgroundBehavior { get set} &#x2F;&#x2F; appè¿›å…¥åå°</p>
</li>
<li><p>var AnimationView.contentMode: UIViewContentMode { get set } &#x2F;&#x2F; å¾ªç¯æ’­æ”¾æ¨¡å¼ã€‚é»˜è®¤æ˜¯playOnceï¼Œè¿˜æœ‰autoReverseæ— é™å¾ªç¯</p>
</li>
<li><p>var AnimationView.isAnimationPlaying: Bool { get set } &#x2F;&#x2F; åˆ¤æ–­åŠ¨ç”»æ˜¯å¦åœ¨æ’­æ”¾</p>
</li>
<li><p>var AnimationView.animationSpeed: CGFloat { get set } &#x2F;&#x2F; åŠ¨ç”»é€Ÿåº¦</p>
</li>
<li><p>func AnimationView.forceDisplayUpdate() &#x2F;&#x2F; å¼ºåˆ¶é‡ç»˜åŠ¨ç”»è§†å›¾</p>
</li>
</ol>
</blockquote>
<p><strong>ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨<code>Lottie</code>çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰é”™è¯¯æˆ–è€…ä¸è¶³ä¹‹å¤„è¿˜æœ›æŒ‡æ­£ï¼Œè°¢è°¢</strong></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CLottie%E2%80%9D/" rel="tag">â€œLottieâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CiOS%E2%80%9D/" rel="tag">â€œiOSâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9C%E5%8A%A8%E7%94%BB%E2%80%9D/" rel="tag">â€œåŠ¨ç”»â€</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="[layout]-é¡¹ç›®å‰–æ01-swift-WebSocket"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/23/%E9%A1%B9%E7%9B%AE%E5%89%96%E6%9E%9001-swift-WebSocket/"
    >é¡¹ç›®å‰–æ01-swift WebSocket</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/12/23/%E9%A1%B9%E7%9B%AE%E5%89%96%E6%9E%9001-swift-WebSocket/" class="article-date">
  <time datetime="2019-12-23T02:00:16.000Z" itemprop="datePublished">2019-12-23</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/swift/">swift</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>å·²ç»å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰æ€»ç»“é¡¹ç›®äº†ï¼Œæ­£å¥½æœ€è¿‘å®Œæˆé¡¹ç›®ç¬¬äºŒç‰ˆçš„æ”¹ç‰ˆ(æ–°é¡¹ç›®å®Œå…¨æ˜¯ç”¨swiftå†™çš„)ï¼Œå°±æŠŠé¡¹ç›®ä¸­ä¸€äº›æœ‰æ„ä¹‰çš„çŸ¥è¯†å—åœ¨æ­¤è®°å½•ä¸€ä¸‹ï¼Œ é¡¹ç›®ä¸­æœ‰å®æ—¶çš„äº¤æ˜“éœ€è¦å±•ç¤ºï¼Œæ‰€ä»¥ç”¨åˆ°äº†socketé•¿é“¾æ¥ï¼Œæˆ‘ç”¨çš„æ˜¯<a target="_blank" rel="noopener" href="https://github.com/daltoniam/Starscream">Starscream</a>è¿™ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œé›†æˆæ–¹æ³•å¾ˆç®€å•å»ç½‘ç«™çœ‹çœ‹å°±çŸ¥é“ã€‚</p>
</blockquote>
<h3 id="å…ˆä¸Šä»£ç "><a href="#å…ˆä¸Šä»£ç " class="headerlink" title="å…ˆä¸Šä»£ç "></a>å…ˆä¸Šä»£ç </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import Reachability</span><br><span class="line">import Starscream</span><br><span class="line">import zlib</span><br><span class="line"></span><br><span class="line">let reachability = Reachability()! // åˆ¤æ–­ç½‘ç»œè¿æ¥</span><br><span class="line">let webSocket = WTWebsocket.shared</span><br><span class="line">var reConnectTime = 0 // è®¾ç½®é‡è¿æ¬¡æ•°</span><br><span class="line">let reConnectMaxTime = 1000 // è®¾ç½®æœ€å¤§é‡è¿æ¬¡æ•°</span><br><span class="line">let reConnectIntervalTime: TimeInterval = 15 // è®¾ç½®é‡è¿æ—¶é—´é—´éš”(ç§’)</span><br><span class="line">var websocketTimer: Timer? = nil</span><br><span class="line">var reConnectSubscribeDict:[String : Any] = [:]</span><br><span class="line">var page = &quot;home&quot;</span><br><span class="line">var isReconnect = true</span><br><span class="line"></span><br><span class="line">final class WTWebsocket: NSObject,WebSocketDelegate &#123;</span><br><span class="line">    </span><br><span class="line">    var isPingBack = true</span><br><span class="line">    var myWebsocket: WebSocket? = nil</span><br><span class="line">    //  socketè¿æ¥ä¸Šå‡½æ•°</span><br><span class="line">    func websocketDidConnect(socket: WebSocketClient) &#123;</span><br><span class="line">        //è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œè§£å†³æ— é™é‡è¿é—®é¢˜</span><br><span class="line">        reConnectTime = 0</span><br><span class="line">        if reConnectSubscribeDict.count &gt; 0 &#123;</span><br><span class="line">            self.subscribe(subscribeDict: reConnectSubscribeDict)</span><br><span class="line">        &#125;</span><br><span class="line">        self.hearJump()</span><br><span class="line">        if  websocketTimer == nil &#123;</span><br><span class="line">            websocketTimer = Timer.scheduledTimer(timeInterval: reConnectIntervalTime, target: self, selector: #selector(sendBrandStr), userInfo: nil, repeats: true)</span><br><span class="line">        &#125;</span><br><span class="line">        isReconnect = true</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //å‘é€æ–‡å­—æ¶ˆæ¯</span><br><span class="line">    @objc func sendBrandStr()&#123;</span><br><span class="line">        self.checkPing()</span><br><span class="line">        let json = getJSONStringFromDictionary(dictionary: [&quot;topic&quot;:&quot;PING&quot;])</span><br><span class="line">        SingletonSocket.sharedInstance.socket.write(string: json)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å‘é€ping</span><br><span class="line">    func hearJump() &#123;</span><br><span class="line">        let json = getJSONStringFromDictionary(dictionary: [&quot;topic&quot;:&quot;PING&quot;])</span><br><span class="line">        SingletonSocket.sharedInstance.socket.write(string: json)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //  socketæ–­å¼€æ‰§è¡Œå‡½æ•°</span><br><span class="line">    func websocketDidDisconnect(socket: WebSocketClient, error: Error?) &#123;</span><br><span class="line">        //æ‰§è¡Œé‡æ–°è¿æ¥æ–¹æ³•</span><br><span class="line">        socketReconnect()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //  æ¥æ”¶è¿”å›æ¶ˆæ¯å‡½æ•°</span><br><span class="line">    func websocketDidReceiveMessage(socket: WebSocketClient, text: String) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func websocketDidReceiveData(socket: WebSocketClient, data: Data) &#123;</span><br><span class="line">        guard let newStr = String(data: data.gzipUncompress(), encoding: .utf8) else &#123;return&#125;</span><br><span class="line">        if newStr == &quot;PONG&quot; &#123;</span><br><span class="line">            isPingBack = true</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">      // å¤„ç†æ”¶åˆ°çš„ä¿¡æ¯</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æ·»åŠ æ³¨å†Œ</span><br><span class="line">    func subscribe(subscribeDict: [String : Any]) &#123;</span><br><span class="line">        var subscribeDicts = subscribeDict</span><br><span class="line">        reConnectSubscribeDict = subscribeDicts</span><br><span class="line">        page = subscribeDicts[&quot;type&quot;] as! String</span><br><span class="line">        subscribeDicts.removeValue(forKey: &quot;type&quot;)</span><br><span class="line">        let json = getJSONStringFromDictionary(dictionary:</span><br><span class="line">            subscribeDicts as NSDictionary)</span><br><span class="line">        SingletonSocket.sharedInstance.socket.write(string: json)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //æ£€æµ‹</span><br><span class="line">    @objc func checkPing() &#123;</span><br><span class="line">        if !isPingBack &#123;</span><br><span class="line">            // é‡æ–°è¿æ¥</span><br><span class="line">            socketReconnect()</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            isPingBack = false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //æ„é€ å•ä¾‹æ•°æ®</span><br><span class="line">    static let shared = WTWebsocket()</span><br><span class="line">    private override init() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//socket é‡è¿é€»è¾‘</span><br><span class="line">func socketReconnect() &#123;</span><br><span class="line">    //åˆ¤æ–­ç½‘ç»œæƒ…å†µï¼Œå¦‚æœç½‘ç»œæ­£å¸¸ï¼Œå¯ä»¥æ‰§è¡Œé‡è¿</span><br><span class="line">    if reachability.connection != .none &#123;</span><br><span class="line">        //è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œè§£å†³æ— é™é‡è¿é—®é¢˜</span><br><span class="line">        reConnectTime =  reConnectTime + 1</span><br><span class="line">        if reConnectTime &lt; reConnectMaxTime &#123;</span><br><span class="line">            //æ·»åŠ é‡è¿å»¶æ—¶æ‰§è¡Œï¼Œé˜²æ­¢æŸä¸ªæ—¶é—´æ®µï¼Œå…¨éƒ¨æ‰§è¡Œ</span><br><span class="line">            let time: TimeInterval = 2.0</span><br><span class="line">            DispatchQueue.main.asyncAfter(deadline: DispatchTime.now() + time) &#123;</span><br><span class="line">                SingletonSocket.sharedInstance.socket.connect()</span><br><span class="line">                SingletonSocket.sharedInstance.socket.disconnect()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //æç¤ºé‡è¿å¤±è´¥</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //æç¤ºæ— ç½‘ç»œ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//socketä¸»åŠ¨æ–­å¼€ï¼Œæ”¾åœ¨appè¿›å…¥åå°æ—¶ï¼Œæ•°æ®è¿›å…¥ç¼“å­˜ã€‚appå†è¿›å…¥å‰å°ï¼Œappå‡ºç°å¡æ­»çš„æƒ…å†µ</span><br><span class="line">func socketDisConnect() &#123;</span><br><span class="line">    if !SingletonSocket.sharedInstance.socket.isConnected &#123;</span><br><span class="line">        websocketTimer?.invalidate()</span><br><span class="line">        websocketTimer = nil</span><br><span class="line">        SingletonSocket.sharedInstance.socket.disconnect()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// initSocketæ–¹æ³•</span><br><span class="line">func initWebSocketSingle () &#123;</span><br><span class="line">    SingletonSocket.sharedInstance.socket.delegate = webSocket</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å£°æ˜webSocketå•ä¾‹</span><br><span class="line">class SingletonSocket &#123;</span><br><span class="line">    let socket:WebSocket = WebSocket(url: URL(string: AppURLHOST.SocketURL)!)</span><br><span class="line">    class var sharedInstance : SingletonSocket&#123;</span><br><span class="line">        struct Static&#123;</span><br><span class="line">            static let instance:SingletonSocket = SingletonSocket()</span><br><span class="line">        &#125;</span><br><span class="line">        if !Static.instance.socket.isConnected&#123;</span><br><span class="line">            Static.instance.socket.connect()</span><br><span class="line">        &#125;</span><br><span class="line">        return Static.instance</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ•´ä¸ªä»£ç å¾ˆç®€å•ï¼ŒåŸºæœ¬éƒ½æœ‰æ³¨é‡Šï¼Œå¤§æ¦‚èŠä¸€èŠé‡Œé¢çš„ä¸€äº›å…³é”®ç‚¹"><a href="#æ•´ä¸ªä»£ç å¾ˆç®€å•ï¼ŒåŸºæœ¬éƒ½æœ‰æ³¨é‡Šï¼Œå¤§æ¦‚èŠä¸€èŠé‡Œé¢çš„ä¸€äº›å…³é”®ç‚¹" class="headerlink" title="æ•´ä¸ªä»£ç å¾ˆç®€å•ï¼ŒåŸºæœ¬éƒ½æœ‰æ³¨é‡Šï¼Œå¤§æ¦‚èŠä¸€èŠé‡Œé¢çš„ä¸€äº›å…³é”®ç‚¹"></a>æ•´ä¸ªä»£ç å¾ˆç®€å•ï¼ŒåŸºæœ¬éƒ½æœ‰æ³¨é‡Šï¼Œå¤§æ¦‚èŠä¸€èŠé‡Œé¢çš„ä¸€äº›å…³é”®ç‚¹</h3><blockquote>
<p>å‘é€ping-ä¿—ç§°å‘é€å¿ƒè·³ï¼Œè¿™ä¸ªä¸»è¦æ˜¯åˆ¤æ–­socketæ˜¯å¦æ–­å¼€ï¼Œé“¾æ¥æˆåŠŸåæ¯æ¬¡é—´éš”å›ºå®šæ—¶é—´å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œç„¶ååœ¨è¿”å›ä¸­ä¿®æ”¹isPingBackï¼Œåœ¨ä¸‹ä¸€æ¬¡å‘é€è¯·æ±‚å‰æ£€æŸ¥isPingBackåˆ¤æ–­ä¸Šä¸€æ¬¡çš„è¯·æ±‚æ˜¯å¦è¿”å›ï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­socketæ˜¯å¦æ–­å¼€ï¼Œè¿™ä¸ªé—´éš”æ—¶é—´å¯ä»¥è‡ªç”±è®¾å®šï¼Œä½†æ˜¯æœ€å¥½ä¸è¦å¤ªçŸ­ï¼Œå¤ªçŸ­æœ‰å¯èƒ½æ˜¯socketè¿æ¥äº†ä½†æ˜¯æ²¡æœ‰æ¥å¾—åŠè¿”å›ã€‚å½“ç„¶å¤ªé•¿ä¹Ÿä¸è¡Œï¼Œè¿™å¯èƒ½å¯¼è‡´å‘ç°socketæ–­å¼€ä¸åŠæ—¶ã€‚</p>
</blockquote>
<p><strong>appåœ¨åå°éœ€è¦æ–­å¼€socketï¼Œå½“ appé‡æ–°è¿›å…¥å‰å°éœ€è¦é‡æ–°è¿æ¥</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">func applicationWillResignActive(_ application: UIApplication) &#123;</span><br><span class="line">        //è¿›å…¥åå°æ¨¡å¼ï¼Œä¸»åŠ¨æ–­å¼€socketï¼Œé˜²æ­¢å‡ºç°å¤„ç†ä¸äº†çš„æƒ…å†µ</span><br><span class="line">        if SingletonSocket.sharedInstance.socket.isConnected &#123;</span><br><span class="line">            reConnectTime = reConnectMaxTime</span><br><span class="line">            socketDisConnect()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    func applicationDidBecomeActive(_ application: UIApplication) &#123;</span><br><span class="line">        //è¿›å…¥å‰å°æ¨¡å¼ï¼Œä¸»åŠ¨è¿æ¥socket</span><br><span class="line">        //è§£å†³å› ä¸ºç½‘ç»œåˆ‡æ¢æˆ–é“¾æ¥ä¸ç¨³å®šé—®é¢˜ï¼Œå¼•èµ·socketæ–­è¿é—®é¢˜</span><br><span class="line">        //å¦‚æœappä»æ— ç½‘ç»œï¼Œåˆ°å›å¤ç½‘ç»œï¼Œéœ€è¦æ‰§è¡Œé‡è¿</span><br><span class="line">        if !isFirstApplicationDidBecomeActive &#123;</span><br><span class="line">            reConnectTime = 0</span><br><span class="line">            socketReconnect()</span><br><span class="line">            WTBasicConfigManager.shareDataSingle.getHash()</span><br><span class="line">        &#125;</span><br><span class="line">        isFirstApplicationDidBecomeActive = false</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸€å®šè¦è®¾ç½®æœ€å¤§é‡æ–°è¿æ¥çš„æ¬¡æ•°ï¼Œä¸ç„¶appä¼šæ— é™é‡æ–°è¿æ¥</strong></p>
<p><strong>è¿æ¥æˆåŠŸæˆ–è€…é‡è¿æˆåŠŸéƒ½éœ€è¦å¯¹éœ€è¦æ¨é€çš„æ•°æ®è¿›è¡Œä¸€æ¬¡ç½‘ç»œè¯·æ±‚ï¼Œç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§ã€‚</strong></p>
<blockquote>
<p>ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨WebSocketçš„æ–¹æ³•ï¼Œå¦‚æœæœ‰é”™è¯¯æˆ–è€…ä¸è¶³ä¹‹å¤„è¿˜æœ›æŒ‡æ­£ï¼Œè°¢è°¢</p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CWebSocket%E2%80%9D/" rel="tag">â€œWebSocketâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9Cswift%E2%80%9D/" rel="tag">â€œswiftâ€</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="[layout]-iOSé›†æˆèäº‘SDKå³æ—¶é€šè®¯æ•´ç†"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2018/03/29/iOS%E9%9B%86%E6%88%90%E8%9E%8D%E4%BA%91SDK%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%95%B4%E7%90%86/"
    >iOSé›†æˆèäº‘SDKå³æ—¶é€šè®¯æ•´ç†</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2018/03/29/iOS%E9%9B%86%E6%88%90%E8%9E%8D%E4%BA%91SDK%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E6%95%B4%E7%90%86/" class="article-date">
  <time datetime="2018-03-29T06:36:05.000Z" itemprop="datePublished">2018-03-29</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/iOS/">iOS</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="iOSé›†æˆèäº‘SDKå³æ—¶é€šè®¯æ•´ç†"><a href="#iOSé›†æˆèäº‘SDKå³æ—¶é€šè®¯æ•´ç†" class="headerlink" title="iOSé›†æˆèäº‘SDKå³æ—¶é€šè®¯æ•´ç†"></a>iOSé›†æˆèäº‘SDKå³æ—¶é€šè®¯æ•´ç†</h2><blockquote>
<p>æœ€è¿‘å¾ˆå°‘å†™ä¸€ä¸‹é¡¹ç›®æ€»ç»“äº†ï¼Œæœ€è¿‘é¡¹ç›®è™½ç„¶åšäº†å¾ˆå¤šï¼Œä½†æ˜¯éƒ½æ˜¯ä¸€äº›å¤–åŒ…é¡¹ç›®ï¼Œåšä¸‹æ¥ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå€¼å¾—æ€»ç»“çš„ã€‚æœ€è¿‘ä¸€ä¸ªé¡¹ç›®ç”¨åˆ°äº†èäº‘å³æ—¶é€šè®¯ï¼Œä»¥å‰åŸºæœ¬éƒ½æ˜¯ç”¨ç¯ä¿¡ï¼Œæ‰€ä»¥è¿˜é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹è®°å½•ä¸€ä¸‹ã€‚</p>
</blockquote>
<h3 id="å¤´åƒã€æ˜µç§°ç­‰ç”¨æˆ·ä¿¡æ¯-èäº‘å¯¹è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§å¤„ç†æ–¹å¼"><a href="#å¤´åƒã€æ˜µç§°ç­‰ç”¨æˆ·ä¿¡æ¯-èäº‘å¯¹è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§å¤„ç†æ–¹å¼" class="headerlink" title="å¤´åƒã€æ˜µç§°ç­‰ç”¨æˆ·ä¿¡æ¯(èäº‘å¯¹è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§å¤„ç†æ–¹å¼)"></a>å¤´åƒã€æ˜µç§°ç­‰ç”¨æˆ·ä¿¡æ¯(èäº‘å¯¹è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§å¤„ç†æ–¹å¼)</h3><p><strong>ç”¨æˆ·ä¿¡æ¯æä¾›è€…</strong></p>
<blockquote>
<p>å®ç°æ­¥éª¤(ä»¥ä¸‹ä»£ç æ”¾åœ¨å•ä¾‹ä¸­ï¼Œå¯ä»¥æ˜¯AppDelegateï¼Œæœ€å¥½å•ç‹¬å†™ä¸€ä¸ªå•ä¾‹)  </p>
<p>é¦–å…ˆéµå®ˆRCIMUserInfoDataSourceè¿™ä¸ªåè®® </p>
</blockquote>
<p><strong>ç„¶åæ˜¯è¦è®¾ç½®ä»£ç†</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RCIM sharedRCIM] setUserInfoDataSource:self]; </span><br></pre></td></tr></table></figure>
<p><strong>æœ€åå®ç°ä»£ç†æ–¹æ³•ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">- (void)getUserInfoWithUserId:(NSString *)userId completion:(void (^)(RCUserInfo *))completion &#123;</span><br><span class="line">    NSLog(@&quot;getUserInfoWithUserId ----- %@&quot;, userId);</span><br><span class="line">    RCUserInfo *user = [RCUserInfo new];</span><br><span class="line">    if (userId == nil || [userId length] == 0) &#123;</span><br><span class="line">        user.userId = userId;</span><br><span class="line">        user.portraitUri = @&quot;&quot;;</span><br><span class="line">        user.name = @&quot;&quot;;</span><br><span class="line">        completion(user);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if ([userId isEqualToString:[UserInfo shareInstance].uid]) &#123;</span><br><span class="line">        NSString *urlSelf = [BASIC_URL_image stringByAppendingString:[UserInfo shareInstance].photo];</span><br><span class="line">        return completion([[RCUserInfo alloc] initWithUserId:userId name:[UserInfo shareInstance].nickname portrait:urlSelf]);</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">    </span><br><span class="line">  //æ ¹æ®å­˜å‚¨è”ç³»äººä¿¡æ¯çš„æ¨¡å‹ï¼Œé€šè¿‡ userId æ¥å–å¾—å¯¹åº”çš„nameå’Œå¤´åƒurlï¼Œè¿›è¡Œä»¥ä¸‹è®¾ç½®</span><br><span class="line">    [WTBaseHttpRequst postRequstWithURL:getUserHttp params:@&#123;@&quot;uid&quot;:[UserInfo shareInstance].uid, @&quot;api_token&quot;:[UserInfo shareInstance].api_token, @&quot;k_uid&quot;:userId&#125; successBlock:^(NSDictionary *returnData) &#123;</span><br><span class="line">        if ([returnData[@&quot;status&quot;] integerValue] == 1) &#123;</span><br><span class="line">            NSString *urlStr = [BASIC_URL_image stringByAppendingString:returnData[@&quot;data&quot;][@&quot;user&quot;][@&quot;photo&quot;]];</span><br><span class="line">            return completion([[RCUserInfo alloc] initWithUserId:userId name:returnData[@&quot;data&quot;][@&quot;user&quot;][@&quot;nickname&quot;] portrait:urlStr]);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            completion(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; failureBlock:^(NSString *error) &#123;</span><br><span class="line">        completion(user);</span><br><span class="line">    &#125; showHUD:NO];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿™ä¸ªæ–¹æ³•ä¸éœ€è¦ä½ è‡ªå·±æ‰‹åŠ¨è°ƒç”¨ï¼Œåªæ˜¯å½“ä½ åœ¨ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯æ—¶è°ƒç”¨æ–¹æ³•å³å¯</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RCIM sharedRCIM] refreshUserInfoCache:user withUserId:[UserInfo shareInstance].uid]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">WS(weakSelf);</span><br><span class="line">// ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯è°ƒç”¨</span><br><span class="line">[WTBaseHttpRequst postRequstWithURL:modifyInfoHttp params:dict successBlock:^(NSDictionary *returnData) &#123;</span><br><span class="line">    [weakSelf MBProgressHudShowWithTextOnlyWithText:returnData[@&quot;msg&quot;]];</span><br><span class="line">    if ([returnData[@&quot;status&quot;] integerValue] == 1) &#123;</span><br><span class="line">        RCUserInfo *user = [RCUserInfo new];</span><br><span class="line">        user.userId = [UserInfo shareInstance].uid;</span><br><span class="line">        user.portraitUri = [BASIC_URL_image stringByAppendingString:[UserInfo shareInstance].photo];</span><br><span class="line">        user.name = weakSelf.nickNameTextField.text;</span><br><span class="line">        [[RCIM sharedRCIM] refreshUserInfoCache:user withUserId:[UserInfo shareInstance].uid];</span><br><span class="line">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.5 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [self.navigationController popViewControllerAnimated:YES];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; failureBlock:^(NSString *error) &#123;</span><br><span class="line">    [weakSelf MBProgressHudShowWithTextOnlyWithText:error];</span><br><span class="line">&#125; showHUD:YES];</span><br></pre></td></tr></table></figure>

<p><strong>åœ¨æ‰©å±•æ¶ˆæ¯ä¸­æºå¸¦ç”¨æˆ·ä¿¡æ¯</strong></p>
<blockquote>
<p>è®¾ç½®å‘é€æ¶ˆæ¯æ—¶åœ¨æ¶ˆæ¯ä½“ä¸­æºå¸¦ç”¨æˆ·ä¿¡æ¯(ä»2.4.1 ä¹‹åé™„åŠ ç”¨æˆ·ä¿¡æ¯ä¹‹åcellé»˜è®¤ä¼šæ˜¾ç¤ºé™„åŠ çš„ç”¨æˆ·ä¿¡æ¯çš„å¤´åƒï¼Œå³ç”¨æˆ·ä¿¡æ¯ä¸ä¼šå–ç”¨æˆ·ä¿¡æ¯æä¾›è€…é‡Œæä¾›çš„ç”¨æˆ·ä¿¡æ¯)</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[RCIM sharedRCIM].enableMessageAttachUserInfo = YES; </span><br><span class="line">```  </span><br><span class="line">  </span><br><span class="line">**ä½ è®¾ç½®äº†enableMessageAttachUserInfoä¹‹åï¼Œå¯ä»¥å–åˆ°**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&#x2F;**  </p>
<ul>
<li>å‘é€è€…ä¿¡æ¯</li>
<li>**&#x2F;<br>@property(nonatomic, strong) RCUserInfo *senderUserInfo; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">**å½“ç„¶æˆ‘è§‰å¾—è¿˜å¯ä»¥ä»åå°è·å–å¥½å‹å…³ç³»åï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡ç™»é™†åï¼Œå¼€ä¸€ä¸ªçº¿ç¨‹æŠŠå¥½å‹å…³ç³»è¯·æ±‚ä¸‹æ¥å­˜èµ·æ¥ç„¶åæ ¹æ®ç¯ä¿¡IDæŸ¥æ‰¾å¥½å‹çš„æ˜µç§°å’Œå¤´åƒ**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### ç»™è¾“å…¥æ¡†æ·»åŠ æç¤ºè¯­(è¿™ä¸ªæˆ‘ä¸€ç›´è§‰å¾—ç¯ä¿¡åº”è¯¥ç»™äº†æ–¹æ³•ä¿®æ”¹ï¼Œåªæ˜¯æˆ‘ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥åªæœ‰è‡ªå·±å»å†™äº†)</span><br><span class="line">  </span><br><span class="line">**åˆ›å»ºæç¤ºçš„label**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
_lab &#x3D; [[UILabel alloc] initWithFrame:self.chatSessionInputBarControl.inputTextView.bounds];<br>_lab.text &#x3D; @â€è¯·è¾“å…¥æ–‡å­—ä¿¡æ¯â€¦â€;<br>_lab.textColor &#x3D; [UIColor colorWithHexColor:@â€ddddddâ€];<br>_lab.font &#x3D; [UIFont systemFontOfSize:15];<br>_lab.center &#x3D; CGPointMake(_lab.center.x + 15, _lab.center.y);<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**åˆ¤å®šæ˜¯å¦æœ‰è‰ç¨¿æ¥æ˜¾ç¤ºå’Œéšè—æç¤ºçš„label**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
[self.chatSessionInputBarControl.inputTextView addSubview:_lab];<br>if (self.chatSessionInputBarControl.draft &#x3D;&#x3D; nil || self.chatSessionInputBarControl.draft.length &#x3D;&#x3D; 0) {<br> _lab.hidden &#x3D; NO;<br>}else {<br> _lab.hidden &#x3D; YES;<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**æ ¹æ®è¾“å…¥æ•°æ®æ¥åˆ¤å®šæ˜¾ç¤ºéšè—æç¤ºlabel**</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>(void)inputTextView:(UITextView *)inputTextView shouldChangeTextInRange:(NSRange)range replacementText:(NSString *)text {<br>  if (((inputTextView.text.length &#x3D;&#x3D; 1 &amp;&amp; [text isEqualToString:@â€â€]) || (inputTextView.text.length &#x3D;&#x3D; 0 &amp;&amp; text.length &gt; 0))  &amp;&amp; range.length &#x3D;&#x3D; 1 &amp;&amp; range.location &#x3D;&#x3D; 0) {<br>  _lab.hidden &#x3D; NO;<br>  }else {<br>  _lab.hidden &#x3D; YES;<br>  }<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### å–æ¶ˆè¾“å…¥@å¼¹å‡ºå¥½å‹åˆ—è¡¨ç•Œé¢ï¼Œä¿ç•™é•¿æŒ‰å¤´åƒ@æ–¹æ³•</span><br><span class="line"></span><br><span class="line">**é¦–å…ˆåœ¨AppDelegateä¸­å¼€å¯æ¶ˆæ¯@åŠŸèƒ½ï¼ˆåªæ”¯æŒç¾¤èŠå’Œè®¨è®ºç»„, Appéœ€è¦å®ç°ç¾¤æˆå‘˜æ•°æ®æºgroupMemberDataSourceï¼‰**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
[RCIM sharedRCIM].enableMessageMentioned &#x3D; YES;</li>
</ul>
<p>ç„¶ååœ¨ç»§æ‰¿RCConversationViewControllerçš„æ§åˆ¶å™¨ä¸­è°ƒç”¨<br>-(void)showChooseUserViewController:(void (^)(RCUserInfo *selectedUserInfo))selectedBlock<br>                         cancel:(void (^)())cancelBlock {<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">### åœ¨ä¼šè¯åˆ—è¡¨ä¸­æ·»åŠ ä¸€äº›å›ºå®šçš„cell(ç»§æ‰¿RCConversationListViewController)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F; å¯¹è‡ªå®šä¹‰cellèµ‹å€¼</p>
<ul>
<li>(RCConversationBaseCell *)rcConversationListTableView:(UITableView *)tableView<br>                            cellForRowAtIndexPath:(NSIndexPath *)indexPath {<br>  RCCustomCell *cell &#x3D; (RCCustomCell *)[[RCCustomCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@â€RCCustomCellâ€];<br>  RCConversationModel *model &#x3D; self.conversationListDataSource[indexPath.row];<br>  cell.nameLabel.text &#x3D; model.conversationTitle;<br>  return cell;<br>}</li>
</ul>
<p>&#x2F;&#x2F; æ·»åŠ è‡ªå®šä¹‰cellçš„æ•°æ®æº</p>
<ul>
<li>(NSMutableArray *)willReloadTableData:(NSMutableArray *)dataSource{<br>  NSArray *arr &#x3D; @[@â€è®ºå›å›å¤å’Œ@æˆ‘çš„â€, @â€é™Œç”Ÿäººç§ä¿¡â€, @â€å¹¸å­˜è€…éƒ¨è½@æˆ‘çš„â€, @â€é—®å·è°ƒæŸ¥â€];<br>  for (int i &#x3D; 0; i&lt;arr.count; i++) {<br>  RCConversationModel *model &#x3D; [[RCConversationModel alloc]init];<br>  model.conversationModelType &#x3D; RC_CONVERSATION_MODEL_TYPE_CUSTOMIZATION;<br>  model.conversationTitle &#x3D; arr[i];<br>  model.isTop &#x3D; YES;<br>  [dataSource insertObject:model atIndex:i];<br>  }<br>  return dataSource;<br>}</li>
</ul>
<p>&#x2F;&#x2F; ç‚¹å‡»cellè·³è½¬</p>
<ul>
<li>(void)onSelectedTableRow:(RCConversationModelType)conversationModelType<br>   conversationModel:(RCConversationModel *)model<br>     atIndexPath:(NSIndexPath *)indexPath{<br>  if (indexPath.row &#x3D;&#x3D; 0) {<br>  WTForumAndConnectListViewController *chatList &#x3D; (WTForumAndConnectListViewController *)[WTStoryBoardSegment instantiateViewControllerWithStoryBoardName:@â€Mainâ€ identifier:@â€WTForumAndConnectListViewControllerâ€];<br>  chatList.title &#x3D; @â€å›å¤å’Œ@æˆ‘çš„â€;<br>  [self.navigationController pushViewController:chatList animated:YES];<br>  }else if (indexPath.row &#x3D;&#x3D; 1) {<br>  WTChatListViewController *chatList &#x3D; [[WTChatListViewController alloc] init];<br>  chatList.title &#x3D; @â€é™Œç”Ÿäººç§ä¿¡â€;<br>  chatList.isEnteredToCollectionViewController &#x3D; YES;<br>  chatList.type &#x3D; 1;<br>  chatList.friendArray &#x3D; self.friendArray;<br>  [self.navigationController pushViewController:chatList animated:YES];<br>  }else if (indexPath.row &#x3D;&#x3D; 2) {<br>  WTChatListViewController *chatList &#x3D; [[WTChatListViewController alloc] init];<br>  chatList.title &#x3D; @â€å¹¸å­˜è€…éƒ¨è½@æˆ‘çš„â€;<br>  chatList.isEnteredToCollectionViewController &#x3D; YES;<br>  chatList.type &#x3D; 2;<br>  [self.navigationController pushViewController:chatList animated:YES];<br>  }else if (indexPath.row &#x3D;&#x3D; 3) {<br>  WTQuestionnaireViewController *questionnaire &#x3D; (WTQuestionnaireViewController *)[WTStoryBoardSegment instantiateViewControllerWithStoryBoardName:@â€Mainâ€ identifier:@â€WTQuestionnaireViewControllerâ€];<br>  [self.navigationController pushViewController:questionnaire animated:YES];<br>  }else {<br>  &#x2F;&#x2F;ç‚¹å‡»cellï¼Œæ‹¿åˆ°cellå¯¹åº”çš„modelï¼Œç„¶åä»modelä¸­æ‹¿åˆ°å¯¹åº”çš„RCUserInfoï¼Œç„¶åèµ‹å€¼ä¼šè¯å±æ€§ï¼Œè¿›å…¥ä¼šè¯<br>  if (model.conversationType &#x3D;&#x3D; ConversationType_PRIVATE) {&#x2F;&#x2F;å•èŠ<br>      WTMyConversationLisViewController *_conversationVC &#x3D; [[WTMyConversationLisViewController alloc]init];<br>      _conversationVC.conversationType &#x3D; model.conversationType;<br>      _conversationVC.targetId &#x3D; model.targetId;<br>      _conversationVC.title &#x3D; model.conversationTitle;<br>      [self.navigationController pushViewController:_conversationVC animated:YES];<br>  }else if (model.conversationType &#x3D;&#x3D; ConversationType_GROUP){&#x2F;&#x2F;ç¾¤èŠ<br>      WTMyConversationLisViewController *_conversationVC &#x3D; [[WTMyConversationLisViewController alloc]init];<br>      _conversationVC.conversationType &#x3D; model.conversationType;<br>      _conversationVC.title &#x3D; model.conversationTitle;<br>      _conversationVC.targetId &#x3D; model.targetId;<br>      [self.navigationController pushViewController:_conversationVC animated:YES];<br>  }<br>  }<br>}<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### åœ¨ä»»æ„åœ°æ–¹è·å–èŠå¤©åˆ—è¡¨æ•°é‡åŠåˆ é™¤åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">**è·å–èŠå¤©åˆ—è¡¨**   </span><br><span class="line"></span><br></pre></td></tr></table></figure>
NSArray *privateArr &#x3D; [[RCIMClient sharedRCIMClient] getConversationList:@[@(ConversationType_PRIVATE)]];<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**åœ¨ConversationListæ·»åŠ å¯¹åº”ç±»å‹çš„èŠå¤©å°±å¯ä»¥è·å–å¯¹åº”ç±»å‹çš„èŠå¤©åˆ—è¡¨åˆ é™¤æ–¹æ³•ç±»ä¼¼**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
[[RCIMClient sharedRCIMClient] clearConversations:@[@(ConversationType_PRIVATE)]];</li>
</ul>
<pre><code>
### èƒŒæ™¯å›¾

&gt; èäº‘èŠå¤©åˆ—è¡¨æ²¡æœ‰æ•°æ®çš„é»˜è®¤å›¾ç‰‡ä¸‹é¢æœ‰ç‚¹å‡»å³ä¸Šè§’åŠ å…¥èŠå¤©ï¼Œå¯æ˜¯ä¸æ˜¯æ‰€æœ‰çš„èŠå¤©éƒ½æœ‰è¿™ä¸ªåŠŸèƒ½(æˆ‘çš„å°±æ²¡æœ‰)å¦‚ä½•æ²¡æœ‰å°±å¯ä»¥åœ¨èµ„æºæ–‡ä»¶ä¸­æ‰¾åˆ° no\_message\_img è¿™å¼ å›¾ç‰‡ç”¨pså»æ‰ä¸‹é¢çš„é‚£ä¸€è¡Œå­—

### å…¶å®ƒ

&gt; ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨ä½¿ç”¨èäº‘è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜åŠè§£å†³æ–¹æ³•ï¼Œå¦‚æœæœ‰é”™è¯¯æˆ–è€…ä¸è¶³ä¹‹å¤„è¿˜æœ›æŒ‡æ­£ï¼Œè°¢è°¢ï¼
</code></pre>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CiOS%E2%80%9D/" rel="tag">â€œiOSâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9C%E8%9E%8D%E4%BA%91%E2%80%9D/" rel="tag">â€œèäº‘â€</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="[layout]-UISearchBarè¯¦è§£"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2017/03/11/UISearchBar%E8%AF%A6%E8%A7%A3/"
    >UISearchBarè¯¦è§£</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2017/03/11/UISearchBar%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time datetime="2017-03-10T16:27:34.000Z" itemprop="datePublished">2017-03-11</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/swift/">swift</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>ä»Šå¤©å…¬å¸çš„é¡¹ç›®æµ‹è¯•çš„å·®ä¸å¤šäº†ï¼ŒåŸºæœ¬å¯ä»¥ä¸Šæ¶äº†ï¼Œåˆæœ‰æ—¶é—´æ¥åˆ†äº«ä¸€ä¸‹æœ€è¿‘é‡åˆ°çš„ä¸€äº›é—®é¢˜äº†ï¼Œå…¬å¸çš„é¡¹ç›®è¿›è¡Œäº†å¤§æ”¹ç‰ˆï¼ˆåº”è¯¥æ˜¯å…¨æ”¹äº†ï¼ŒåŸºæœ¬æ˜¯ä¸€ä¸ªæ–°çš„é¡¹ç›®äº†ï¼‰ï¼Œè€å¤§å†³å®šç”¨swifté‡å†™ã€‚ä¹‹å‰ä¸€ç›´åœ¨è‡ªå­¦swiftï¼Œç»ˆäºè¿™ä¸€æ¬¡å¯ä»¥å®æˆ˜äº†ã€‚é¡¹ç›®ä¸­æœç´¢ç”¨çš„æ¯”è¾ƒå¤šï¼Œä½†æ˜¯æœç´¢æ¡†çš„æ ·å¼ä¸é»˜è®¤çš„å·®åˆ«å¤ªå¤§äº†ï¼Œæ‰€ä»¥åªèƒ½è‡ªå®šä¹‰äº†ã€‚</p>
</blockquote>
<p>The UISearchBar class implements a text field control for text-based searches. The control provides a text field for entering text, a search button, a bookmark button, and a cancel button. The UISearchBar object does not actually perform any searches. You use a delegate, an object conforming to the UISearchBarDelegate protocol, to implement the actions when text is entered and buttons are clicked.</p><p>

<blockquote>
<p>ä»¥ä¸Šæ˜¯è‹¹æœå¯¹UISearchBarçš„è§£é‡Šï¼Œå¯ä»¥çœ‹è§UISearchBaræä¾›äº†ç±»ä¼¼UITextFieldçš„è¾“å…¥ï¼ˆå…¶å®å®ƒçš„ç»„æˆä¸­å°±æœ‰UITextFieldï¼Œä¸‹é¢ä¼šè®²åˆ°ï¼‰ï¼Œå³è¾¹æœ‰æœç´¢æŒ‰é’®ã€æ ‡ç­¾æŒ‰é’®ã€å…³é—­æŒ‰é’®å¯ä¾›é€‰æ‹©ï¼Œæœç´¢éƒ½æ˜¯åœ¨åè®®UISearchBarDelegateä¸­è¿›è¡Œã€‚</p>
</blockquote>
</p><p><strong>è‡ªå®šä¹‰å¤–è§‚</strong></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/7efbcef7e9cb93c4383fe6794bdbefdf.webp?x-image-process=image/format,png" alt="é»˜è®¤æœç´¢å¤–è§‚"></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/226c294545fe64cc3f3f91cd71df0146.webp?x-image-process=image/format,png" alt="é¡¹ç›®æœç´¢å¤–è§‚"></p>
<blockquote>
<p>UISearchBarçš„å±‚çº§å¾ˆæ˜¯å¤æ‚ä¸»è¦ç”±UISearchBarBackgroudã€UISearchBarTextFieldã€<br>UINavigationButtonç»„æˆï¼Œå…¶ä¸­UISearchBarTextFieldå°±æ˜¯è¾“å…¥æ¡†ï¼Œä¸»è¦æ˜¯ç”±â€”â€”UISearchBarSearchFieldBackgroundViewã€UIButtonï¼ˆâŒï¼‰ã€UIImageViewï¼ˆ?ï¼‰ç­‰ç»„æˆï¼Œ</p>
</blockquote>
<p><strong>è·å–TextFieldæ–¹æ³•ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let searchFiled:UITextField = self.searchBar.value(forKey: &quot;_searchField&quot;) as! UITextField</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>è¿™æ ·å°±å¯ä»¥é€šè¿‡ä¿®æ”¹	searchFiledæ¥ä¿®æ”¹è¾“å…¥æ ·å¼ï¼ˆåœ†è§’ã€å­—ä½“ç­‰ï¼‰ã€‚</strong></p>
<blockquote>
<p>UISearchBarçš„ç›´æ¥å­æ§ä»¶æ˜¯UIVIewï¼Œå…¶ä¸Šçš„å­æ§ä»¶UISearchBarBackgroudçš„frameä¸UISearchBarçš„boundsç›¸ç­‰ï¼ŒUISearchBarTextFieldçš„é«˜åº¦é»˜è®¤ä¸º28ä¸UISearchBarå·¦å³æœ‰8åƒç´ çš„å›ºå®šé—´è·ï¼Œä¸Šä¸‹é—´è·ä¸ºç›´æ¥å­æ§ä»¶UIViewçš„é«˜åº¦ - UISearchBarTextFieldçš„é»˜è®¤é«˜åº¦28 å†é™¤ä»¥2ã€‚å› æ­¤UISearchBarçš„è¾“å…¥æ¡†å§‹ç»ˆä¸è®¾ç½®çš„frameä¸ä¸€æ ·ï¼Œä¸ä¾¿äºå¸ƒå±€ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªå­ç±»ç»§æ‰¿UISearchBarï¼Œå¯ä»¥æ›´æ”¹å…¶å†…è¾¹è·ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">class MySearchBar: UISearchBar &#123;</span><br><span class="line">    </span><br><span class="line">    // ç›‘å¬æ˜¯å¦æ·»åŠ äº†è¯¥å±æ€§</span><br><span class="line">    var contentInset: UIEdgeInsets? &#123;</span><br><span class="line">        didSet &#123;</span><br><span class="line">            self.layoutSubviews()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func layoutSubviews() &#123;</span><br><span class="line">        super.layoutSubviews()</span><br><span class="line">        // ä¾¿åˆ©å¯»æ‰¾</span><br><span class="line">        for view in self.subviews &#123;</span><br><span class="line">            for subview in view.subviews &#123;</span><br><span class="line">                // åˆ¤å®šæ˜¯å¦æ˜¯UISearchBarTextField</span><br><span class="line">                if subview.isKind(of: UITextField.classForCoder()) &#123;</span><br><span class="line">                    if let textFieldContentInset = contentInset &#123;</span><br><span class="line">                        // ä¿®æ”¹UISearchBarTextFieldçš„å¸ƒå±€</span><br><span class="line">                        subview.frame = CGRect(x: textFieldContentInset.left, y: textFieldContentInset.top, width: self.bounds.width - textFieldContentInset.left - textFieldContentInset.right, height: self.bounds.height - textFieldContentInset.top - textFieldContentInset.bottom)</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        // è®¾ç½®UISearchBarä¸­UISearchBarTextFieldçš„é»˜è®¤è¾¹è·</span><br><span class="line">                        let top: CGFloat = (self.bounds.height - 28.0) / 2.0</span><br><span class="line">                        let bottom: CGFloat = top</span><br><span class="line">                        let left: CGFloat = 8.0</span><br><span class="line">                        let right: CGFloat = left</span><br><span class="line">                        contentInset = UIEdgeInsets(top: top, left: left, bottom: bottom, right: right)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è®©å®ä¾‹åŒ–çš„UISearchBarç»§æ‰¿MySearchBarï¼Œç„¶åå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›´æ¥æ§åˆ¶å†…è¾¹è·äº†</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.searchBar.contentInset = UIEdgeInsets(top: 0, left: 0, bottom: 0, right: 0)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ¥ä¸‹æ¥å°±æ˜¯å¤„ç†placeholderé å·¦ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼ŒæŸ¥è¯¢äº†ä¸€å¤§å †åŠæ³•éƒ½æŒºéº»çƒ¦çš„ï¼Œæœ€åæ‰¾åˆ°äº†ä¸€ä¸ªå¾ˆæŠ•æœºçš„åŠæ³•ï¼šå…ˆåˆ¤å®šæ‰‹æœºå®½åº¦ï¼Œç„¶ååœ¨placeholderå³è¾¹åŠ ä¸Šç©ºæ ¼åšæˆé å·¦çš„å‡è±¡ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if SCREEN.WIDTH == 320 &#123;</span><br><span class="line">           self.searchBar.placeholder = &quot;æœç´¢ä½ç½®       &quot;</span><br><span class="line">       &#125;else if SCREEN.WIDTH == 373\5 &#123;</span><br><span class="line">           self.searchBar.placeholder = &quot;æœç´¢ä½ç½®                  &quot;</span><br><span class="line">       &#125;else if SCREEN.WIDTH == 414 &#123;</span><br><span class="line">           self.searchBar.placeholder = &quot;æœç´¢ä½ç½®                                 &quot;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç„¶ååœ¨storyboardä¸­è®¾ç½®searchBarçš„BarStyleä¸ºMinimalå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ§åˆ¶UISearchBarçš„å¤–è§‚äº†ã€‚<br>åˆ°è¿™é‡Œå°±å‰©ä¸€ä¸ªé—®é¢˜äº†ï¼šUISearchBarä¸Šä¸‹çš„ä¸¤æ ¹é»‘çº¿äº†ï¼Œ</p>
</blockquote>
<p><strong>å»é™¤æ–¹æ³•ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.searchBar.setBackgroundImage(UIImage.init(), for: .any, barMetrics: .default)</span><br></pre></td></tr></table></figure>

<p><strong>æœç´¢çš„ä½¿ç”¨</strong></p>
<blockquote>
<p>å¦‚è‹¹æœå®˜æ–¹æ–‡æ¡£æ‰€è¯´ï¼Œä¸æœç´¢ç›¸å…³çš„éƒ½æ˜¯åœ¨å…¶ä»£ç†æ–¹æ³•ä¸­å®Œæˆã€‚UISearchBaræœ‰å¾ˆå¤šçš„ä»£ç†æ–¹æ³•ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç‚¹å‡»è¿›å…¥æŸ¥çœ‹</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/reference/uikit/uisearchbardelegate">UISearchBarDelegate</a>æˆ‘å°±ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„ï¼š</p>
<blockquote>
<p>å½“æœç´¢å†…å®¹å˜åŒ–æ—¶ï¼Œæ‰§è¡Œè¯¥æ–¹æ³•,å¯ä»¥å®æ—¶ç›‘å¬è¾“å…¥æ¡†çš„å˜åŒ–,å¯ä»¥å®ç°æ—¶å®æœç´¢ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)searchBar:(UISearchBar *)searchBar shouldChangeTextInRange:(NSRange)range replacementText:(NSString *)textNS_AVAILABLE_IOS(3_0);                 // called before text changes</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¹Ÿè¡Œä½ æƒ³æŠŠæœç´¢äº‹ä»¶æ”¾åœ¨ç‚¹å‡»æœç´¢ä»¥åå†è§¦å‘ï¼Œé‚£å°±é€‰ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒå°±æ˜¯ç‚¹å‡»æœç´¢åçš„ä»£ç†æ–¹æ³•</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)searchBarSearchButtonClicked:(UISearchBar *)searchBar;</span><br></pre></td></tr></table></figure>

<h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><blockquote>
<p>å½“ç„¶å¦‚æœä½ è§‰å¾—è¿™æ ·å¤ªéº»çƒ¦äº†ï¼Œä½ è¿˜å¯ä»¥é€‰æ‹©ç”¨UITextFieldæ¥å®ç°UISearchBarçš„åŠŸèƒ½ï¼Œä½†æ˜¯æœ€ç»ˆå“ªä¸€ä¸ªæ›´åŠ çš„éº»çƒ¦è¿˜éœ€è¦è¯•ä¸€è¯•æ‰çŸ¥é“ã€‚</p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CUISearchBar%E2%80%9D/" rel="tag">â€œUISearchBarâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9CiOS%E2%80%9D/" rel="tag">â€œiOSâ€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9Cswift%E2%80%9D/" rel="tag">â€œswiftâ€</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="[layout]-å¾®ä¿¡å°ç¨‹åºtips"
  class="article article-type-[layout]"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2017/02/22/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8Ftips/"
    >å¾®ä¿¡å°ç¨‹åºtips</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2017/02/22/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8Ftips/" class="article-date">
  <time datetime="2017-02-21T17:19:52.000Z" itemprop="datePublished">2017-02-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">å¾®ä¿¡å°ç¨‹åº</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>æœ€è¿‘å…¬å¸é¡¹ç›®æ”¹ç‰ˆï¼Œè¶äº§å“ä¿®æ”¹ä¸UIå‡ºå›¾çš„é—´æ­‡ç”¨å…¬å¸å•†æˆ·ç«¯UIå›¾æ’¸äº†ä¸€æŠŠå¾®ä¿¡å°ç¨‹åºã€‚å› ä¸ºåˆšåˆšå®ä¹ é‚£ä¸€ä¼šæ¥è§¦è¿‡å‰ç«¯å¼€å‘ï¼Œæ‰€ä»¥ä¸Šæ‰‹è¿˜æ¯”è¾ƒå¿«ï¼Œå½“ç„¶ä¹Ÿé‡åˆ°äº†å¾ˆå¤šçš„é—®é¢˜ï¼Œä¸è¿‡å¥½åœ¨åŸºæœ¬æŒ‰å›¾å®Œæˆã€‚è¶æ­¤æ€»ç»“ä¸€ä¸‹æˆ‘é‡åˆ°çš„é—®é¢˜,å¥‰ä¸Šä¸€äº›å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©ä¸æˆ‘é‡åˆ°ç›¸åŒé—®é¢˜çš„æœ‹å‹ã€‚<a target="_blank" rel="noopener" href="https://github.com/GavinCarter1991/wx-onePro">demo</a> </p>
</blockquote>
<h3 id="å…ˆä¸Šå›¾"><a href="#å…ˆä¸Šå›¾" class="headerlink" title="å…ˆä¸Šå›¾"></a>å…ˆä¸Šå›¾</h3><p><img src="https://i-blog.csdnimg.cn/blog_migrate/b6d605c3b3e52fc14fcf8b758b6c4b33.webp?x-image-process=image/format,png" alt="å¾®ä¿¡å°ç¨‹åº"></p>
<h3 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h3><p><strong>èƒŒæ™¯å›¾ç‰‡ä¸èƒ½ä½¿ç”¨æœ¬åœ°çš„</strong></p>
<blockquote>
<p>è¿™ä¸ªé—®é¢˜å‘äº†æˆ‘å¾ˆä¹…ï¼Œå› ä¸ºåœ¨æ¨¡æ‹Ÿå™¨ä¸Šè·‘æ—¶ï¼Œå°†æœ¬åœ°å›¾ç‰‡ä½œä¸ºViewçš„èƒŒæ™¯å›¾ç‰‡æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸€åˆ°çœŸæœºæµ‹è¯•å°±ä¸æ˜¾ç¤ºèƒŒæ™¯å›¾ç‰‡äº†ï¼Œä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯è·¯å¾„é”™äº†ï¼Œç»è¿‡æµ‹è¯•å‘ç°è·¯å¾„æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæœ€ååœ¨ç½‘ä¸Šæ‰¾åˆ°äº†åŸå› ï¼šå¾®ä¿¡å°ç¨‹åºçš„èƒŒæ™¯å›¾ç‰‡ä¸èƒ½æ˜¯æœ¬åœ°å›¾ç‰‡ï¼Œå¿…é¡»æ˜¯æ˜¯ç½‘ç»œå›¾ç‰‡ï¼Œäºæ˜¯æˆ‘å°±æ‰¾äº†ä¸€ä¸ªç½‘ç«™å°†å›¾ç‰‡ä¼ äº†ä¸Šå»ï¼Œå°†ç½‘å€ä½œä¸ºèƒŒæ™¯å›¾ç‰‡é“¾æ¥ï¼Œå°±å¥‡è¿¹èˆ¬çš„æ˜¾ç¤ºäº†ï¼Œå¾ˆæ˜¯æ— è¯­ã€‚</p>
</blockquote>
<h3 id="ä¸èƒ½åŠ è½½ç½‘é¡µ"><a href="#ä¸èƒ½åŠ è½½ç½‘é¡µ" class="headerlink" title="ä¸èƒ½åŠ è½½ç½‘é¡µ"></a>ä¸èƒ½åŠ è½½ç½‘é¡µ</h3><blockquote>
<p>å¾®ä¿¡å°ç¨‹åºæ˜¯ä¸èƒ½è·³è½¬åˆ°ç½‘é¡µçš„ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºå¾®ä¿¡å°ç¨‹åºæœ¬èº«å°±å¦‚åŒç½‘é¡µå§ï¼Œä¹Ÿå¯èƒ½æ˜¯å¾®ä¿¡ä¸æƒ³æœ‰äººè¶Šè¿‡å®ƒçš„å®¡æ ¸ï¼Œåæ­£ä»–æ˜¯ä¸å…è®¸ç›´æ¥åŠ è½½ç½‘é¡µçš„ã€‚</p>
</blockquote>
<h3 id="ä¸èƒ½éšè—å¯¼èˆªæ "><a href="#ä¸èƒ½éšè—å¯¼èˆªæ " class="headerlink" title="ä¸èƒ½éšè—å¯¼èˆªæ "></a>ä¸èƒ½éšè—å¯¼èˆªæ </h3><blockquote>
<p>æˆ‘çš„ç™»é™†é¡µé¢æœ¬æ¥æ˜¯ä¸åº”è¯¥æœ‰å¯¼èˆªæ çš„ï¼Œå¯æ˜¯å°±æ˜¯éšè—ä¸äº†ï¼Œä¹Ÿè®¸æœ‰æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘æ‰¾äº†å¾ˆä¹…ä¹Ÿæ²¡æœ‰å‘ç°ã€‚</p>
</blockquote>
<h3 id="åªæ”¯æŒHTTPSçš„ç½‘ç»œåè®®å¹¶ä¸”ä¸€ä¸ªæœˆåªèƒ½ä¿®æ”¹5æ¬¡"><a href="#åªæ”¯æŒHTTPSçš„ç½‘ç»œåè®®å¹¶ä¸”ä¸€ä¸ªæœˆåªèƒ½ä¿®æ”¹5æ¬¡" class="headerlink" title="åªæ”¯æŒHTTPSçš„ç½‘ç»œåè®®å¹¶ä¸”ä¸€ä¸ªæœˆåªèƒ½ä¿®æ”¹5æ¬¡"></a>åªæ”¯æŒHTTPSçš„ç½‘ç»œåè®®å¹¶ä¸”ä¸€ä¸ªæœˆåªèƒ½ä¿®æ”¹5æ¬¡</h3><blockquote>
<p>åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ç½‘ç»œè¯·æ±‚åªèƒ½æ˜¯httpsç±»å‹çš„ã€‚åœ¨æ·»åŠ URLçš„æ—¶å€™éƒ½å·²ç»é™åˆ¶æ­»äº†ã€‚å¹¶ä¸”ä¸€ä¸ªæœˆåªèƒ½ä¿®æ”¹5æ¬¡ï¼Œç½‘ç»œè¯·æ±‚å¿…é¡»å…ˆè¿›è¡ŒæœåŠ¡å™¨åŸŸåé…ç½®ã€‚</p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/48f1eaa31d6ea1dd09c872920e359dee.webp?x-image-process=image/format,png" alt="æ·»åŠ URL"><br>)</p>
<h3 id="æ‰€æœ‰çš„é¡µé¢éƒ½å¿…é¡»åœ¨app-jsonä¸­é…ç½®è·¯å¾„"><a href="#æ‰€æœ‰çš„é¡µé¢éƒ½å¿…é¡»åœ¨app-jsonä¸­é…ç½®è·¯å¾„" class="headerlink" title="æ‰€æœ‰çš„é¡µé¢éƒ½å¿…é¡»åœ¨app.jsonä¸­é…ç½®è·¯å¾„"></a>æ‰€æœ‰çš„é¡µé¢éƒ½å¿…é¡»åœ¨app.jsonä¸­é…ç½®è·¯å¾„</h3><blockquote>
<p>æˆ‘ä¹‹å‰æ–°å»ºä¸€ä¸ªé¡µé¢ç„¶åè·³è½¬è¿‡å»ä¸€ç›´æŠ¥è·¯å¾„é”™è¯¯ï¼Œå»ç½‘ä¸ŠæŸ¥è¯¢æ‰çŸ¥é“ï¼Œæ¯ä¸€ä¸ªé¡µé¢è·¯å¾„éƒ½éœ€è¦æå‰é…ç½®ã€‚</p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/2cb2cfa23e160b24cec566232710f644.webp?x-image-process=image/format,png" alt="é¡µé¢è·¯å¾„é…ç½®"></p>
<h3 id="ç½‘ç»œè¯·æ±‚çš„æœ€å¤§å¹¶å‘æ•°ä¸º5ã€é¡µé¢å±‚çº§æœ€å¤š5å±‚"><a href="#ç½‘ç»œè¯·æ±‚çš„æœ€å¤§å¹¶å‘æ•°ä¸º5ã€é¡µé¢å±‚çº§æœ€å¤š5å±‚" class="headerlink" title="ç½‘ç»œè¯·æ±‚çš„æœ€å¤§å¹¶å‘æ•°ä¸º5ã€é¡µé¢å±‚çº§æœ€å¤š5å±‚"></a>ç½‘ç»œè¯·æ±‚çš„æœ€å¤§å¹¶å‘æ•°ä¸º5ã€é¡µé¢å±‚çº§æœ€å¤š5å±‚</h3><blockquote>
<p>å°±æ˜¯è¯´åŒæ—¶æœ€å¤š5ä¸ªç½‘ç»œè¯·æ±‚ï¼Œé¡µé¢çš„å­é¡µé¢æœ€å¤š4ä¸ªã€‚æˆ‘åœ¨æƒ³è¦æ˜¯ä¸€ä¸ªé¡µé¢æ˜¯ä¸€ä¸ªè§†é¢‘åˆ—è¡¨å±•ç¤ºæ€ä¹ˆåŠï¼Œæ¯ä¸€ä¸ªè§†é¢‘éƒ½éœ€è¦ç½‘ç»œè¯·æ±‚å•Šã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯è¿™æ¬¡é‡åˆ°çš„ä¸€äº›æ¯”è¾ƒå˜æ€çš„é—®é¢˜ã€‚</p>
</blockquote>
<h3 id="è°ˆè°ˆæˆ‘çš„ä¸€äº›ä»£ç å®ç°"><a href="#è°ˆè°ˆæˆ‘çš„ä¸€äº›ä»£ç å®ç°" class="headerlink" title="è°ˆè°ˆæˆ‘çš„ä¸€äº›ä»£ç å®ç°"></a>è°ˆè°ˆæˆ‘çš„ä¸€äº›ä»£ç å®ç°</h3><p><strong>é…ç½®tabBar(app.json)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&quot;tabBar&quot;: &#123;</span><br><span class="line">  &quot;color&quot;: &quot;#888888&quot;,</span><br><span class="line">  &quot;selectedColor&quot;: &quot;#09BB07&quot;,</span><br><span class="line">  &quot;backgroundColor&quot;: &quot;&quot;,</span><br><span class="line">  &quot;borderStyle&quot;: &quot;white&quot;,</span><br><span class="line">  &quot;list&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;pagePath&quot;: &quot;pages/orderManage/orderManage&quot;,</span><br><span class="line">      &quot;text&quot;: &quot;è®¢å•ç®¡ç†&quot;,</span><br><span class="line">      &quot;iconPath&quot;: &quot;pages/images/order.png&quot;,</span><br><span class="line">      &quot;selectedIconPath&quot;: &quot;pages/images/order_r.png&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;pagePath&quot;: &quot;pages/moneyManage/moneyManage&quot;,</span><br><span class="line">      &quot;text&quot;: &quot;è´¢åŠ¡ç®¡ç†&quot;,</span><br><span class="line">      &quot;iconPath&quot;: &quot;pages/images/money.png&quot;,</span><br><span class="line">      &quot;selectedIconPath&quot;: &quot;pages/images/money_r.png&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;pagePath&quot;: &quot;pages/myself/myself&quot;,</span><br><span class="line">      &quot;text&quot;: &quot;æˆ‘çš„å•†æˆ·&quot;,</span><br><span class="line">      &quot;iconPath&quot;: &quot;pages/images/people.png&quot;,</span><br><span class="line">      &quot;selectedIconPath&quot;: &quot;pages/images/people_r.png&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è®¢å•ç®¡ç†é¡µçš„èœå•æ "><a href="#è®¢å•ç®¡ç†é¡µçš„èœå•æ " class="headerlink" title="è®¢å•ç®¡ç†é¡µçš„èœå•æ "></a>è®¢å•ç®¡ç†é¡µçš„èœå•æ </h3><blockquote>
<p>ç‚¹å‡»èœå•æ åˆ‡æ¢Viewç®€å•ï¼Œç›´æ¥å°†å°†ç‚¹å‡»çš„èœå•çš„å€¼èµ‹ç»™Viewè®©å…¶åç§»å¯¹åº”çš„ç™¾åˆ†æ¯”å°±å¥½ã€‚</p>
<p>æ‰‹åŠ¿åˆ‡æ¢ï¼šé€šè¿‡è§¦æ‘¸çš„èµ·ç‚¹ä¸ç»ˆç‚¹è®¡ç®—å‡ºæ»‘åŠ¨æ–¹å‘ï¼Œç„¶ååç§»å¹¶ä¸”åˆ‡æ¢èœå•æ ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">    catchtouchstart:function(e)&#123;</span><br><span class="line">    var that = this;</span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      startPoint: [e.touches[0].clientX,e.touches[0].clientY]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  catchtouchend:function(e)&#123;</span><br><span class="line">    var that = this;</span><br><span class="line">    var currentNum = parseInt(this.data.currentNavtab);</span><br><span class="line">    var endPoint = [e.changedTouches[0].clientX,e.changedTouches[0].clientY];</span><br><span class="line">    var startPoint = that.data.startPoint</span><br><span class="line">    if(endPoint[0] &lt;= startPoint[0]) &#123;</span><br><span class="line">      if(Math.abs(endPoint[0] - startPoint[0]) &gt;= Math.abs(endPoint[1] - startPoint[1]) &amp;&amp; currentNum&lt; this.data.navTab.length -1) &#123;</span><br><span class="line">         currentNum=currentNum + 1;  </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">      if(Math.abs(endPoint[0] - startPoint[0]) &gt;= Math.abs(endPoint[1] - startPoint[1]) &amp;&amp; currentNum &gt; 0) &#123;</span><br><span class="line">          currentNum -= 1;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      currentNavtab: currentNum</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">// ç‚¹å‡»èœå•æ åˆ‡æ¢View</span><br><span class="line">  switchTab: function(e)&#123;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      currentNavtab: e.currentTarget.dataset.idx</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><blockquote>
<p>æ•´ä¸ªç¨‹åºè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå°±æ˜¯åˆæ¬¡å†™è¿˜æ˜¯æœ‰äº›ä¸é€‚åº”ã€‚å°¤å…¶æ˜¯æŠŠdivæ”¹ä¸ºäº†Viewï¼Œä¸èƒ½ä½¿ç”¨windowå¯¹è±¡å’Œdocumentå¯¹è±¡ï¼Œå¾ˆä¸é€‚åº”ã€‚å†æ¬¡å¥‰ä¸Š<a target="_blank" rel="noopener" href="https://github.com/GavinCarter1991/wx-onePro">demo</a></p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E2%80%9C%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E2%80%9D/" rel="tag">â€œå¾®ä¿¡å°ç¨‹åºâ€</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">ä¸‹ä¸€é¡µ</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2025
        <i class="ri-heart-fill heart_icon"></i> kindyourself@163.com
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>è®¿é—®äººæ•°:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>æµè§ˆæ¬¡æ•°:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Gavin&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">ä¸»é¡µ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">å½’æ¡£</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">åˆ†ç±»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">æ ‡ç­¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.jianshu.com/u/51707eacf496">ç®€ä¹¦</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">å‹é“¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">å…³äºæˆ‘</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="æœç´¢">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>è¯·æˆ‘å–æ¯å’–å•¡å§~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.png">
      <span class="reward-type">æ”¯ä»˜å®</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.png">
      <span class="reward-type">å¾®ä¿¡</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // sliderå±•å¼€çŠ¶æ€
                // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // è·å¾—åŸå›¾å°ºå¯¸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>